<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Using Sentiment Analysis to Design a Drug Recommendation Application</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <!-- Favicons -->
    <link href="../../assets/img/web-icon.png" rel="icon">
    <link href="../../assets/img/apple-touch-icon.png" rel="apple-touch-icon">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,700,700i&display=swap" rel="stylesheet">
    <!-- Vendor CSS Files -->
    <link href="../../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../assets/vendor/animate.css/animate.min.css" rel="stylesheet">
    <link href="../../assets/vendor/icofont/icofont.min.css" rel="stylesheet">
    <link href="../../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="../../assets/vendor/venobox/venobox.css" rel="stylesheet">
    <link href="../../assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="../../assets/vendor/aos/aos.css" rel="stylesheet">
    <!-- Template Main CSS File -->
    <link href="../../assets/css/style.css" rel="stylesheet">
    <link href="../../assets/css/prism.css" rel="stylesheet">
  </head>
  <body>
    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top ">
      <div class="container">
        <div class="logo float-left">
          <h1 class="text-light"><a href="../../index.html"><span>pyDataScientist</span></a></h1>
        </div>
        <nav class="nav-menu float-right d-none d-lg-block">
          <ul>
            <li><a href="../../index.html">Home</a></li>
            <li class="active"><a href="../../projects.html">Projects</a></li>
            <li class="drop-down"><a href="../../notes.html">Tutorials</a>
            <ul>
              <li><a href="../../notes.html#Pandas">Pandas</a></li>
              <li class="drop-down"><a href="../../notes.html#Machine-Learning">Machine Learning</a>
              <ul>
                <li><a href="linear_regression.html">Linear Regression</a></li>
                <li><a href="linear_regression.html">Support Vector Machines</a></li>
                <li><a href="linear_regression.html">Naive Bayes</a></li>
                <li><a href="linear_regression.html">Decision Trees</a></li>
                <li><a href="linear_regression.html">Ensemble Methods</a></li>
              </ul>
            </li>
            <li><a href="../../notes.html#Linear-Algebra">Linear Algebra</a></li>
            <li><a href="../../notes.html#Visualization">Visualization</a></li>
            <li><a href="../../notes.html#Jupyter-Notebook">Jupyter Notebook</a></li>
            <li><a href="../../notes.html#Git">Git</a></li>
            <li><a href="../../notes.html#Bash">Bash</a></li>
            <li><a href="../../notes.html#Deep-Learning">Deep Learning</a></li>
            <li><a href="../../notes.html#Conda">Conda</a></li>
            <li><a href="../../notes.html#Numerical-Methods">Numerical Methods</a></li>
            <li><a href="../../notes.html#Big-Data">Big Data</a></li>
            <li><a href="../../notes.html#Classification">Classification</a></li>
            <li><a href="../../notes.html#Pattern-Recognition">Pattern Recognition</a></li>
            <li><a href="../../notes.html#SQL">SQL</a></li>
          </ul>
        </li>
        <li><a href="../../about.html">About Me</a></li>
        <li><a href="../../contact.html">Contact</a></li>
      </ul>
      </nav><!-- .nav-menu -->
    </div>
    </header><!-- End Header -->
    <main id="main">
      <!-- ======= About Us Section ======= -->
      <section class="breadcrumbs">
        <div class="container">
          <div class="d-flex justify-content-between align-items-center">
            <h2>Projects</h2>
            <ol>
              <li><a href="../../projects2.html">Projects</a></li>
              <li>Using Sentiment Analysis to Design a Drug Recommendation Application</li>
            </ol>
          </div>
        </div>
      </section>
      <!-- End Header -->
      <section class="tutorials" data-aos="fade-up" data-aos-easing="ease-in-out" data-aos-duration="1000">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <h1 id="loading-the-required-libraries">Loading the required libraries</h1>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> warnings
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">from</span> nltk.stem.snowball <span class="hljs-keyword">import</span> SnowballStemmer
<span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords
<span class="hljs-keyword">from</span> nltk <span class="hljs-keyword">import</span> PorterStemmer <span class="hljs-keyword">as</span> Porter_stemmer
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> nltk
<span class="hljs-keyword">from</span> wordcloud <span class="hljs-keyword">import</span> WordCloud, STOPWORDS
<span class="hljs-keyword">import</span> string
<span class="hljs-keyword">from</span> scipy.stats <span class="hljs-keyword">import</span> norm
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats
<span class="hljs-keyword">from</span> matplotlib.colors <span class="hljs-keyword">import</span> Normalize
<span class="hljs-keyword">import</span> matplotlib.cm <span class="hljs-keyword">as</span> cm
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> rc
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> toggle_cell <span class="hljs-keyword">import</span> toggle_code <span class="hljs-keyword">as</span> hide_cell
<span class="hljs-keyword">from</span> viz <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> autopep8
<span class="hljs-keyword">import</span> dill
sys.path.append(<span class="hljs-string">'util'</span>)
sys.path.append(<span class="hljs-string">'visualization'</span>)
plt.rcParams[<span class="hljs-string">'text.usetex'</span>] = <span class="hljs-keyword">True</span>  <span class="hljs-comment"># Let TeX do the typsetting</span>
plt.rcParams[<span class="hljs-string">'text.latex.preamble'</span>] = [<span class="hljs-string">r'\usepackage{sansmath}'</span>, <span class="hljs-string">r'\sansmath'</span>]
plt.rcParams[<span class="hljs-string">'font.family'</span>] = <span class="hljs-string">'sans-serif'</span>  <span class="hljs-comment"># ... for regular text</span>
plt.rcParams[<span class="hljs-string">'font.sans-serif'</span>] = <span class="hljs-string">'Helvetica'</span>  <span class="hljs-comment"># Choose a nice font here</span>
rc(<span class="hljs-string">'font'</span>, **{<span class="hljs-string">'family'</span>: <span class="hljs-string">'serif'</span>, <span class="hljs-string">'serif'</span>: [<span class="hljs-string">'Helvetica'</span>]})
pd.set_option(<span class="hljs-string">'display.float_format'</span>, <span class="hljs-keyword">lambda</span> x: <span class="hljs-string">'%.3f'</span> % x)
warnings.filterwarnings(<span class="hljs-string">'ignore'</span>)
</code></pre>
<form action="javascript:code_toggle()"><input type="submit" id="toggleButton" value="see the code"></form>



<h2 id="-color-green-textbf-opti-color-orange-textbf-med-what-color-orange-textbf-medicine-color-green-textbf-best-suits-your-need-">$\color{green}{\textbf{Opti}}\color{orange}{\textbf{Med}}$ - What $\color{orange}{\textbf{medicine}}$ $\color{green}{\textbf{best}}$ suits your need?</h2>
<p><img src="project_cover.jpeg" alt=""></p>
<h2 id="the-idea-behind-this-project-is-to-analyze-the-patient-review-of-different-drugs-obtained-from-from-drugs-com-and-use-the-results-to-design-a-web-application-https-optimed-stage-herokuapp-com-to-help-the-patient-find-the-best-drugs-according-to-their-symptoms-">The idea behind this project is to analyze the patient review of different drugs (obtained from from Drugs.com) and use the results to design a <a href="https://optimed-stage.herokuapp.com"><strong>web application</strong></a> to help the patient find the best drugs according to their symptoms.</h2>
<h1 id="motivation">Motivation</h1>
<p>I like to break down the idea that I have into a few parts to make it more clear and enhances the thought process for potential development of each part:</p>
<ul>
<li>I spent some time and looked at the different data sources that I knew such as <a href="https://www.reddit.com/r/dataisbeautiful"><strong>Data is beautiful</strong></a>, <a href="https://data.world/"><strong>data.world</strong></a>, <a href="https://tinyletter.com/data-is-plural/letters/data-is-plural-2020-06-17-edition"><strong>Data is plural</strong></a>, <a href="https://www.kaggle.com/datasets"><strong>kaggle</strong></a>, <a href="https://archive.ics.uci.edu/ml/datasets.php"><strong>UCI datasets</strong></a> and so on and found a <a href="https://archive.ics.uci.edu/ml/datasets/Drug+Review+Dataset+%28Drugs.com%29"><strong>Drug Review Dataset (Drugs.com)</strong></a> about cutomer reviews of 3671 unique drugs.</li>
</ul>
<ul>
<li>I thought there are probably many people like me neither know nor look for the drug that best fits their symptoms and just go with that one drug that they always relied on when they had a headache ... So I thought about the ways that this data set can be used to find the best hit from the data set given:<ul>
<li>the symptoms</li>
<li>location (living close to CVS, walgreens etc.)</li>
<li>budget</li>
<li>potential allergies or intolerance</li>
<li>other drugs being taken currently (if any) that can cause drug interactions</li>
<li>urgency of the situation (might influence the importance of the location) </li>
<li>...  </li>
</ul>
</li>
</ul>
<p>of the user.</p>
<h1 id="initial-goal">Initial Goal</h1>
<ul>
<li>Build a natural language processing model to recommend the right medicine according to the user condition</li>
</ul>
<h1 id="future-goal">Future Goal</h1>
<ul>
<li>Use other resources such as <strong><a href="https://www.drugbank.ca/">Drug Bank</a></strong> to make the model more robust by considering potential <strong><em>drug interactions, side effects</em></strong> etc. </li>
<li>Use other APIs such as <strong><a href="https://www.goodrx.com/">GoodRx</a></strong> to build a <strong>real-time model</strong> that considers other user-defined factors such as <strong><em>location, price range, and ease of transportation, weather condition, delivery options</em></strong> etc. to make a more calculated decision</li>
<li>Expand the usefulness of the app to <strong><em>medical professionals</em></strong> so that they can offer <strong><em>patients-customized solutions</em></strong>
</b></li>
</ul>
<h1 id="data-exploration">Data Exploration</h1>
<p>The data was obtained from <a href="https://archive.ics.uci.edu/ml/datasets/Drug+Review+Dataset+%28Drugs.com%29#">UCI Drug Review Dataset (Drugs.com)</a>. The following is the data description provided by the reference:</p>
<div class='summary'>
    <b>Data Set Information:</b>

The dataset provides patient reviews on specific drugs along with related conditions and a 10 star patient rating reflecting overall patient satisfaction. The data was obtained by crawling online pharmaceutical review sites. The intention was to study
<ol>
<li>Sentiment analysis of drug experience over multiple facets, i.e. sentiments learned on specific aspects such as effectiveness and side effects,</li>
<li>the transferability of models among domains, i.e. conditions, and</li>
<li>the transferability of models among different data sources (see <a href='https://archive.ics.uci.edu/ml/machine-learning-databases/00461/'>UCI Drug Review Dataset (Druglib.com)</a>).</li>
</ol>
The data is split into a train (75%) a test (25%) partition (see publication) and stored in two .tsv (tab-separated-values) files, respectively.


<strong>Important notes:</strong>

When using this dataset, you agree that you

<ol>
<li>only use the data for research purposes</li>
<li>don&#39;t use the data for any commerical purposes</li>
<li>don&#39;t distribute the data to anyone else</li>
    <li>cite us</li>
    </ol>

<strong>Attribute Information:</strong>

1. drugName (categorical): name of drug
2. condition (categorical): name of condition
3. review (text): patient review
4. rating (numerical): 10 star patient rating
5. date (date): date of review entry
6. usefulCount (numerical): number of users who found review useful

</div>



<pre><code class="lang-python"><span class="hljs-attr">df_train</span> = pd.read_csv(<span class="hljs-string">'data/drugsComTrain_raw.csv'</span>, parse_dates=[<span class="hljs-string">'date'</span>])
<span class="hljs-attr">df_test</span> = pd.read_csv(<span class="hljs-string">'data/drugsComTest_raw.csv'</span>, parse_dates=[<span class="hljs-string">'date'</span>])
</code></pre>
<pre><code class="lang-python"><span class="hljs-selector-tag">df_train</span><span class="hljs-selector-class">.head</span>(5)
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uniqueID</th>
      <th>drugName</th>
      <th>condition</th>
      <th>review</th>
      <th>rating</th>
      <th>date</th>
      <th>usefulCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>206461</td>
      <td>Valsartan</td>
      <td>Left Ventricular Dysfunction</td>
      <td>&quot;It has no side effect, I take it in combinati...</td>
      <td>9</td>
      <td>2012-05-20</td>
      <td>27</td>
    </tr>
    <tr>
      <th>1</th>
      <td>95260</td>
      <td>Guanfacine</td>
      <td>ADHD</td>
      <td>&quot;My son is halfway through his fourth week of ...</td>
      <td>8</td>
      <td>2010-04-27</td>
      <td>192</td>
    </tr>
    <tr>
      <th>2</th>
      <td>92703</td>
      <td>Lybrel</td>
      <td>Birth Control</td>
      <td>&quot;I used to take another oral contraceptive, wh...</td>
      <td>5</td>
      <td>2009-12-14</td>
      <td>17</td>
    </tr>
    <tr>
      <th>3</th>
      <td>138000</td>
      <td>Ortho Evra</td>
      <td>Birth Control</td>
      <td>&quot;This is my first time using any form of birth...</td>
      <td>8</td>
      <td>2015-11-03</td>
      <td>10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35696</td>
      <td>Buprenorphine / naloxone</td>
      <td>Opiate Dependence</td>
      <td>&quot;Suboxone has completely turned my life around...</td>
      <td>9</td>
      <td>2016-11-27</td>
      <td>37</td>
    </tr>
  </tbody>
</table>
</div>




<pre><code class="lang-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">'train and test shapes are {0} and {1}, respectively.'</span>.<span class="hljs-keyword">format</span>(
    df_train.<span class="hljs-built_in">shape</span>, df_test.<span class="hljs-built_in">shape</span>))
</code></pre>
<pre><code>train and test shapes are (<span class="hljs-number">161297</span>, <span class="hljs-number">7</span>) and (<span class="hljs-number">53766</span>, <span class="hljs-number">7</span>), respectively.
</code></pre><pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove_html</span><span class="hljs-params">(raw_review)</span></span>:

    <span class="hljs-comment"># 1. Remove HTML characters</span>
    <span class="hljs-keyword">return</span> BeautifulSoup(raw_review, <span class="hljs-string">'html.parser'</span>).get_text()
</code></pre>
<pre><code class="lang-python"><span class="hljs-selector-tag">df_test</span><span class="hljs-selector-attr">['review']</span><span class="hljs-selector-class">.apply</span>(<span class="hljs-selector-tag">remove_html</span>)
<span class="hljs-selector-tag">df_train</span><span class="hljs-selector-attr">['review']</span><span class="hljs-selector-class">.apply</span>(<span class="hljs-selector-tag">remove_html</span>)
</code></pre>
<pre><code><span class="hljs-number">0</span>         <span class="hljs-string">"It has no side effect, I take it in combinati...
1         "</span>My son <span class="hljs-keyword">is</span> halfway <span class="hljs-keyword">through</span> his <span class="hljs-keyword">fourth</span> week <span class="hljs-keyword">of</span> ...
<span class="hljs-number">2</span>         <span class="hljs-string">"I used to take another oral contraceptive, wh...
3         "</span>This <span class="hljs-keyword">is</span> <span class="hljs-keyword">my</span> <span class="hljs-keyword">first</span> <span class="hljs-built_in">time</span> using any form <span class="hljs-keyword">of</span> birth...
<span class="hljs-number">4</span>         <span class="hljs-string">"Suboxone has completely turned my life around...
                                ...                        
161292    "</span>I wrote <span class="hljs-keyword">my</span> <span class="hljs-keyword">first</span> report <span class="hljs-keyword">in</span> Mid-October <span class="hljs-keyword">of</span> <span class="hljs-number">201.</span>..
<span class="hljs-number">161293</span>    <span class="hljs-string">"I was given this in IV before surgey. I immed...
161294    "</span>Limited improvement <span class="hljs-keyword">after</span> <span class="hljs-number">4</span> months, developed...
<span class="hljs-number">161295</span>    <span class="hljs-string">"I've been on thyroid medication 49 years, I s...
161296    "</span>I've had chronic constipation all <span class="hljs-keyword">my</span> adult li...
Name: review, Length: <span class="hljs-number">161297</span>, dtype: object
</code></pre><h3 id="data-imputation">Data imputation</h3>
<p>We will exclude any cases where there is a missing value. Check all the columns for <code>NaN</code>s:</p>
<pre><code class="lang-python"><span class="hljs-keyword">for</span> <span class="hljs-keyword">col</span> in df_train.column<span class="hljs-variable">s:</span>
    <span class="hljs-keyword">if</span> df_train[<span class="hljs-keyword">col</span>].isnull().<span class="hljs-built_in">values</span>.any():
        <span class="hljs-keyword">print</span>(<span class="hljs-string">'train data has {0:d} missing values ({1:.2f}%)'</span>
              .format(<span class="hljs-built_in">len</span>(df_train[df_train[<span class="hljs-keyword">col</span>].isna()]),
                      <span class="hljs-built_in">len</span>(df_train[df_train[<span class="hljs-keyword">col</span>].isna()]) / <span class="hljs-built_in">len</span>(df_train)))
    <span class="hljs-keyword">if</span> df_test[<span class="hljs-keyword">col</span>].isnull().<span class="hljs-built_in">values</span>.any():
        <span class="hljs-keyword">print</span>(<span class="hljs-string">'test data has {0:d} missing values ({1:.2f}%)'</span>
              .format(<span class="hljs-built_in">len</span>(df_test[df_test[<span class="hljs-keyword">col</span>].isna()]),
                      <span class="hljs-built_in">len</span>(df_test[df_test[<span class="hljs-keyword">col</span>].isna()]) / <span class="hljs-built_in">len</span>(df_test)))
</code></pre>
<pre><code>train data has 899 missing values (0.01%)
<span class="hljs-keyword">test </span>data has 295 missing values (0.01%)
</code></pre><p>We will decide on what to do with the missing elements as the number of missing values are not significant relative to the entire population. We can now make some <em>observations</em> regarding some of the features e.g. the frequency of cutomer ratings:</p>
<h3 id="making-some-observations-by-exploring-the-features">Making some observations by exploring the features</h3>
<p>We can take a look at the unique values for <code>uniqueID</code>, <code>drugName</code>, and <code>condition</code> to see whether:</p>
<ul>
<li>there are <strong>multiple reviews</strong> from a single user,</li>
<li>get a sense of the number of <strong>unique drugs</strong> in the data set</li>
<li>get a sense of different <strong>drug categories</strong></li>
</ul>
<pre><code class="lang-python">df_all = df_train.<span class="hljs-built_in">append</span>(df_test, ignore_index=True)
<span class="hljs-keyword">for</span> <span class="hljs-built_in">col</span> <span class="hljs-keyword">in</span> ['uniqueID', 'drugName', 'condition']:
    <span class="hljs-built_in">print</span>('{<span class="hljs-number">0</span>:d} <span class="hljs-built_in">unique</span> <span class="hljs-built_in">values</span> <span class="hljs-keyword">for</span> {<span class="hljs-number">1</span>:s} <span class="hljs-keyword">in</span> train data of <span class="hljs-built_in">length</span> {<span class="hljs-number">2</span>:d}'
          .format(len(df_train[<span class="hljs-built_in">col</span>].<span class="hljs-built_in">unique</span>().tolist()), <span class="hljs-built_in">col</span>, len(df_train)))
    <span class="hljs-built_in">print</span>('{<span class="hljs-number">0</span>:d} <span class="hljs-built_in">unique</span> <span class="hljs-built_in">values</span> <span class="hljs-keyword">for</span> {<span class="hljs-number">1</span>:s} <span class="hljs-keyword">in</span> test data of <span class="hljs-built_in">length</span> {<span class="hljs-number">2</span>:d}'
          .format(len(df_test[<span class="hljs-built_in">col</span>].<span class="hljs-built_in">unique</span>().tolist()), <span class="hljs-built_in">col</span>, len(df_test)))
    <span class="hljs-built_in">print</span>('{<span class="hljs-number">0</span>:d} <span class="hljs-built_in">unique</span> <span class="hljs-built_in">values</span> <span class="hljs-keyword">for</span> {<span class="hljs-number">1</span>:s} <span class="hljs-keyword">in</span> the entire data of <span class="hljs-built_in">length</span> {<span class="hljs-number">2</span>:d}'
          .format(len(df_all[<span class="hljs-built_in">col</span>].<span class="hljs-built_in">unique</span>().tolist()),
                  <span class="hljs-built_in">col</span>, len(df_all)))
</code></pre>
<pre><code><span class="hljs-symbol">161297 </span>unique values <span class="hljs-keyword">for</span> uniqueID in train <span class="hljs-keyword">data</span> of length <span class="hljs-number">161297</span>
<span class="hljs-symbol">53766 </span>unique values <span class="hljs-keyword">for</span> uniqueID in test <span class="hljs-keyword">data</span> of length <span class="hljs-number">53766</span>
<span class="hljs-symbol">215063 </span>unique values <span class="hljs-keyword">for</span> uniqueID in the entire <span class="hljs-keyword">data</span> of length <span class="hljs-number">215063</span>
<span class="hljs-symbol">3436 </span>unique values <span class="hljs-keyword">for</span> drugName in train <span class="hljs-keyword">data</span> of length <span class="hljs-number">161297</span>
<span class="hljs-symbol">2637 </span>unique values <span class="hljs-keyword">for</span> drugName in test <span class="hljs-keyword">data</span> of length <span class="hljs-number">53766</span>
<span class="hljs-symbol">3671 </span>unique values <span class="hljs-keyword">for</span> drugName in the entire <span class="hljs-keyword">data</span> of length <span class="hljs-number">215063</span>
<span class="hljs-symbol">885 </span>unique values <span class="hljs-keyword">for</span> condition in train <span class="hljs-keyword">data</span> of length <span class="hljs-number">161297</span>
<span class="hljs-symbol">709 </span>unique values <span class="hljs-keyword">for</span> condition in test <span class="hljs-keyword">data</span> of length <span class="hljs-number">53766</span>
<span class="hljs-symbol">917 </span>unique values <span class="hljs-keyword">for</span> condition in the entire <span class="hljs-keyword">data</span> of length <span class="hljs-number">215063</span>
</code></pre><p>We can now make some <em>observations</em> regarding some of the features e.g. the frequency of cutomer ratings:</p>
<pre><code class="lang-python">fig, <span class="hljs-attr">axes</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
<span class="hljs-attr">titles</span> = ['train', 'test']
<span class="hljs-attr">ylabs</span> = [False, False]
<span class="hljs-keyword">if</span> not np.all(ylabs):
    fig.tight_layout(<span class="hljs-attr">pad=10.0)</span>
<span class="hljs-attr">train_data</span> = df_train['rating'].value_counts()
<span class="hljs-attr">train_data</span> = train_data.sort_values(<span class="hljs-attr">ascending=False)</span>
<span class="hljs-attr">test_data</span> = df_test['rating'].value_counts()
<span class="hljs-attr">test_data</span> = test_data.sort_values(<span class="hljs-attr">ascending=False)</span>

for x, label, ax, title, ylab <span class="hljs-keyword">in</span> zip([train_data.values, test_data.values],
                                     [train_data.index, test_data.index],
                                     axes, titles, ylabs):
    <span class="hljs-attr">g</span> = hist(x, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=label,</span> <span class="hljs-attr">colmap='rainbow',</span>
             <span class="hljs-attr">xlabel='rating',</span> <span class="hljs-attr">title=title,</span> <span class="hljs-attr">colbar=ylab,</span> <span class="hljs-attr">density=False)</span>

plt.show()
</code></pre>
<p><img src="output_23_0.png" alt="png"></p>
<pre><code class="lang-python"><span class="hljs-attr">year_data</span> = df_all['date'].dt.year.value_counts()
<span class="hljs-attr">year_data</span> = year_data.sort_index()
fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
fig.tight_layout()
hist(year_data.values, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=year_data.index,</span> <span class="hljs-attr">colmap='RdYlGn',</span> <span class="hljs-attr">xlabel='year',</span> <span class="hljs-attr">colbar=False,</span>
     <span class="hljs-attr">title='Number</span> of reviews per year', <span class="hljs-attr">density=False,</span> <span class="hljs-attr">rot=0,</span> <span class="hljs-attr">ylabel='review</span> count')

plt.show()
</code></pre>
<p><img src="output_24_0.png" alt="png"></p>
<pre><code class="lang-python"><span class="hljs-attr">year_data</span> = df_all['date'].dt.year.value_counts()
<span class="hljs-attr">year_data</span> = year_data.sort_index()
fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
fig.tight_layout()
hist(year_data.values, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=year_data.index,</span>
     <span class="hljs-attr">colmap='RdYlGn',</span> <span class="hljs-attr">xlabel='year',</span> <span class="hljs-attr">colbar=False,</span>
     <span class="hljs-attr">title='Number</span> of reviews per year', <span class="hljs-attr">density=False,</span> <span class="hljs-attr">rot=0,</span> <span class="hljs-attr">ylabel='review</span> count')

plt.show()
</code></pre>
<p><img src="output_25_0.png" alt="png"></p>
<pre><code class="lang-python">from calendar <span class="hljs-built_in">import</span> month_name
fig, <span class="hljs-attr">axes</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
df_all['year'] = df_all['date'].dt.year
df_all['month'] = df_all['date'].dt.month
<span class="hljs-attr">mean_yearly_rating</span> = df_all.groupby('year')['rating'].mean()
<span class="hljs-attr">mean_monthly_rating</span> = df_all.groupby('month')['rating'].mean()
<span class="hljs-attr">months</span> = [month_name[x] for x <span class="hljs-keyword">in</span> mean_monthly_rating.index]
hist(mean_yearly_rating.values, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=axes[0],</span> <span class="hljs-attr">labels=mean_yearly_rating.index,</span>
     <span class="hljs-attr">colmap='RdYlGn',</span> <span class="hljs-attr">colbar=False,</span> <span class="hljs-attr">xlabel='year',</span> <span class="hljs-attr">ylabel='mean</span> rating', <span class="hljs-attr">title="",</span>
     <span class="hljs-attr">density=False,</span> <span class="hljs-attr">rot=45)</span>
hist(mean_monthly_rating.values, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=axes[1],</span> <span class="hljs-attr">labels=months,</span>
     <span class="hljs-attr">colmap='RdYlGn',</span> <span class="hljs-attr">colbar=False,</span> <span class="hljs-attr">xlabel='month',</span> <span class="hljs-attr">ylabel=None,</span> <span class="hljs-attr">title="",</span>
     <span class="hljs-attr">density=False,</span> <span class="hljs-attr">rot=45)</span>
plt.suptitle('Mean yearly <span class="hljs-literal">and</span> monthly rating ', <span class="hljs-attr">fontsize=20)</span>

plt.show()
</code></pre>
<p><img src="output_26_0.png" alt="png"></p>
<pre><code class="lang-python">from calendar import month_name
fig, axes = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">16</span>, <span class="hljs-number">6</span>), sharey=False)
df_all[<span class="hljs-string">'year'</span>] = df_all[<span class="hljs-string">'date'</span>]<span class="hljs-selector-class">.dt</span><span class="hljs-selector-class">.year</span>
df_all[<span class="hljs-string">'month'</span>] = df_all[<span class="hljs-string">'date'</span>]<span class="hljs-selector-class">.dt</span><span class="hljs-selector-class">.month</span>
mean_yearly_rating = df_all.groupby(<span class="hljs-string">'year'</span>)[<span class="hljs-string">'rating'</span>].mean()
mean_monthly_rating = df_all.groupby(<span class="hljs-string">'month'</span>)[<span class="hljs-string">'rating'</span>].mean()
months = [month_name[x] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> mean_monthly_rating.index]
hist(mean_yearly_rating<span class="hljs-selector-class">.values</span>, fig=fig, ax=axes[<span class="hljs-number">0</span>], labels=mean_yearly_rating<span class="hljs-selector-class">.index</span>,
     colmap=<span class="hljs-string">'RdYlGn'</span>, colbar=<span class="hljs-string">'summer'</span>, xlabel=<span class="hljs-string">''</span>, ylabel=<span class="hljs-string">''</span>, title=<span class="hljs-string">""</span>,
     density=False, rot=<span class="hljs-number">45</span>)
hist(mean_monthly_rating<span class="hljs-selector-class">.values</span>, fig=fig, ax=axes[<span class="hljs-number">1</span>], labels=months,
     colmap=<span class="hljs-string">'RdYlGn'</span>, colbar=None, xlabel=<span class="hljs-string">'month'</span>, ylabel=None, title=<span class="hljs-string">""</span>,
     density=False, rot=<span class="hljs-number">45</span>)
plt.suptitle(<span class="hljs-string">'Mean yearly and monthly rating '</span>, fontsize=<span class="hljs-number">20</span>)

plt.show()
</code></pre>
<p><img src="output_27_0.png" alt="png"></p>
<p>Hmmm... Drugs getting worse? </p>
<pre><code class="lang-python">def hist_simple(x, ax=None, rot=<span class="hljs-number">0</span>, fig=None, <span class="hljs-built_in">color</span>=<span class="hljs-string">"yellow"</span>, <span class="hljs-built_in">labels</span>=[],
                <span class="hljs-built_in">title</span>='<span class="hljs-built_in">title</span>', fontSize=<span class="hljs-number">20</span>, titleSize=<span class="hljs-number">24</span>, fmt='{<span class="hljs-number">0</span>:.1f}'):

    def autolabel(rects):
        <span class="hljs-string">""</span><span class="hljs-string">"Attach a text label above each bar in *rects*, displaying its height."</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">for</span> rect <span class="hljs-keyword">in</span> rects:
            <span class="hljs-built_in">height</span> = rect.get_height()

            ax.annotate(fmt.format(<span class="hljs-built_in">height</span>),
                        xy=(rect.get_x() + rect.get_width() / <span class="hljs-number">2</span>, <span class="hljs-built_in">height</span>),
                        xytext=(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>),  # <span class="hljs-number">3</span> <span class="hljs-built_in">points</span> vertical offset
                        textcoords=<span class="hljs-string">"offset points"</span>,
                        ha='<span class="hljs-built_in">center</span>', va='bottom', fontSize=fontSize)

    <span class="hljs-built_in">width</span> = fig.get_size_inches()[<span class="hljs-number">0</span>]/<span class="hljs-built_in">min</span>(len(<span class="hljs-built_in">labels</span>), <span class="hljs-number">10</span>)/<span class="hljs-number">3</span>
    unique_x = <span class="hljs-built_in">np</span>.arange(<span class="hljs-number">1</span>, len(<span class="hljs-built_in">labels</span>) + <span class="hljs-number">1</span>)
    <span class="hljs-built_in">bars</span> = ax.bar(unique_x, x, <span class="hljs-built_in">width</span>, <span class="hljs-built_in">color</span>=<span class="hljs-built_in">color</span>)
    autolabel(<span class="hljs-built_in">bars</span>)
    ax.spines['top'].set_visible(False)
    ax.spines['right'].set_visible(False)
    # ax.spines['bottom'].set_visible(False)
    ax.spines['left'].set_visible(False)
    # <span class="hljs-built_in">width</span> = <span class="hljs-number">0.25</span>  # must be &lt;<span class="hljs-number">1</span>
    ax.set_ylim([<span class="hljs-number">0</span>, <span class="hljs-number">1.1</span>*<span class="hljs-built_in">max</span>(x)])

    <span class="hljs-keyword">if</span> len(<span class="hljs-built_in">labels</span>) &gt; <span class="hljs-number">50</span>:
        unique_x = <span class="hljs-built_in">np</span>.<span class="hljs-built_in">array</span>([unique_x[<span class="hljs-number">0</span>], unique_x[-<span class="hljs-number">1</span>]])
        <span class="hljs-built_in">labels</span> = [str(<span class="hljs-built_in">labels</span>[<span class="hljs-number">0</span>]), str(<span class="hljs-built_in">labels</span>[-<span class="hljs-number">1</span>])]

    ax.set_xticks(unique_x)
    ax.set_xticklabels(<span class="hljs-built_in">labels</span>, rotation=rot, fontsize=fontSize,
                       horizontalalignment={<span class="hljs-number">0</span>: '<span class="hljs-built_in">center</span>', <span class="hljs-number">45</span>: 'right', <span class="hljs-number">90</span>: '<span class="hljs-built_in">center</span>'}.<span class="hljs-built_in">get</span>(rot))
    ax.set_xlabel(<span class="hljs-string">""</span>)
    yticks = ax.get_yticks()

    # ax.<span class="hljs-built_in">xaxis</span>.set_tick_params(labelsize=fontSize)
    ax.set_title(<span class="hljs-built_in">title</span>, fontsize=int(titleSize))

    ax.set_yticks([])
    ax.set_ylabel(<span class="hljs-string">""</span>)
</code></pre>
<pre><code class="lang-python">fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(12,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
<span class="hljs-attr">mean_yearly_rating</span> = df_all.groupby('year')['rating'].mean()
hist_simple(mean_yearly_rating.values, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=mean_yearly_rating.index,</span>
            <span class="hljs-attr">color='orange',</span> <span class="hljs-attr">rot=0,</span> <span class="hljs-attr">title="Mean</span> Yearly Rating<span class="hljs-string">")</span>
</code></pre>
<p><img src="output_30_0.png" alt="png"></p>
<pre><code class="lang-python">fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(12,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
<span class="hljs-attr">mean_monthly_usefulness</span> = df_all.groupby('month')['rating'].mean()
<span class="hljs-attr">months</span> = [month_name[x] for x <span class="hljs-keyword">in</span> mean_monthly_usefulness.index]

hist_simple(mean_monthly_usefulness.values, <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">labels=months,</span>
            <span class="hljs-attr">color=None,</span> <span class="hljs-attr">rot=45,</span> <span class="hljs-attr">title="Mean</span> monthly rating<span class="hljs-string">")

plt.show()</span>
</code></pre>
<p><img src="output_31_0.png" alt="png"></p>
<p>As we observe, the highly-rated reviews are more frequent compared to the poorly-rated ones. We need to <strong>define a metric</strong> for a <b><font color='green'>good</font></b> vs. <b><font color='red'>bad</font></b> to be able to further inspect the quality of the reviews. For now, we classify the reviews with rating below 5.5 as <b><font color='red'>bad</font></b> and otherwise <b><font color='green'>good</font></b>.</p>
<pre><code class="lang-python"><span class="hljs-attr">df_all_good</span> = df_all[df_all[<span class="hljs-string">'rating'</span>] &gt; <span class="hljs-number">5.5</span>]
<span class="hljs-attr">df_all_bad</span> = df_all[df_all[<span class="hljs-string">'rating'</span>] &lt; <span class="hljs-number">5.5</span>]
</code></pre>
<p>One would expect the <code>drugName</code> and <code>condition</code> to be related in a sense that a certain <code>condition</code> e.g. <em>Birth Control</em> might be an effect produced by many drugs. Similarly, most drugs correspond to more than one condition. We can see the most number of <code>drugName</code>s with a common <code>condition</code> using <strong><code>nunique</code></strong> method of <strong><code>pandas</code></strong> which shows the unique repetitions of elements in a column or row:</p>
<pre><code class="lang-python"><span class="hljs-attr">n_drugs</span> = <span class="hljs-number">20</span>
<span class="hljs-attr">drug_names</span> = list(df_all.groupby(['drugName'])['condition'].nunique(
).sort_values(<span class="hljs-attr">ascending=False)[:n_drugs].index)</span>
<span class="hljs-attr">drug_frequencies</span> = list(df_all.groupby(['drugName'])[
                        'condition'].nunique().sort_values(<span class="hljs-attr">ascending=False)[:n_drugs].values)</span>
fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
fig.tight_layout()
hist(drug_frequencies, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=drug_names,</span> <span class="hljs-attr">colmap='viridis',</span> <span class="hljs-attr">xlabel='drug</span> name', <span class="hljs-attr">colbar='viridis',</span>
     <span class="hljs-attr">title='Top</span> {<span class="hljs-number">0</span>:d} drugs <span class="hljs-keyword">with</span> the highest number of unique effects (conditions)'.format(
         n_drugs),
     <span class="hljs-attr">density=False,</span> <span class="hljs-attr">rot=45)</span>

plt.show()
</code></pre>
<p><img src="output_35_0.png" alt="png"></p>
<pre><code class="lang-python">fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(12,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
<span class="hljs-attr">n_drugs</span> = <span class="hljs-number">10</span>
<span class="hljs-attr">drug_names</span> = list(df_all.groupby(['drugName'])['condition'].nunique(
).sort_values(<span class="hljs-attr">ascending=False)[:n_drugs].index)</span>

<span class="hljs-attr">drug_frequencies</span> = list(<span class="hljs-built_in">map</span>(int, df_all.groupby(['drugName'])[
                        'condition'].nunique().sort_values(<span class="hljs-attr">ascending=False)[:n_drugs].values))</span>

hist_simple(drug_frequencies, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=drug_names,</span> <span class="hljs-attr">fmt='{0:d}',</span>
            <span class="hljs-attr">color='orange',</span> <span class="hljs-attr">rot=45,</span> <span class="hljs-attr">title="Top</span> {<span class="hljs-number">0</span>:d} Drugs <span class="hljs-keyword">with</span> the Highest Number of Unique Effects<span class="hljs-string">".format(n_drugs))
plt.show()</span>
</code></pre>
<p><img src="output_36_0.png" alt="png"></p>
<p>Similarly, we can observe the most frequent <code>condition</code>s that are meant to be treated by all the drugs in the dataset</p>
<pre><code class="lang-python"><span class="hljs-attr">n_drugs</span> = <span class="hljs-number">21</span>
<span class="hljs-attr">top_conditions</span> = list(df_all.groupby(['condition'])[
                      'drugName'].nunique().sort_values(<span class="hljs-attr">ascending=False)[1:n_drugs].index)</span>
<span class="hljs-attr">condition_frequencies</span> = list(df_all.groupby(['condition'])[
                             'drugName'].nunique().sort_values(<span class="hljs-attr">ascending=False)[1:n_drugs].values)</span>
fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
fig.tight_layout()
hist(condition_frequencies, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=top_conditions,</span> <span class="hljs-attr">colmap='viridis',</span> <span class="hljs-attr">xlabel='condition',</span>
     <span class="hljs-attr">title='Top</span> {<span class="hljs-number">0</span>:d} most frequent conditions that are aimed to be treated by drugs'.format(
         n_drugs-<span class="hljs-number">1</span>),
     <span class="hljs-attr">density=True,</span> <span class="hljs-attr">rot=45)</span>

plt.show()
</code></pre>
<p><img src="output_38_0.png" alt="png"></p>
<p>It turns out that during the data creation process from the webserver, phrases ending in <strong><em>&#39;</span> users found this comment helpful.&#39;</em></strong> have been mistakenly considered as a condition while they actually contain information about <code>usefulCount</code>. We can identify the rows corresponding to this error and either remove that row or keep the row and change its <code>consition</code> to <strong>Not Listed/Other</strong>. We choose to keep the rows. We also change <strong>Not Listed/Othe</strong> <code>condition</code>s to <strong>Other</strong>.</p>
<pre><code class="lang-python">mask = df_all[['condition']].apply(lambda x: x.str.contains(
<span class="hljs-code">    'Not Listed|users found this comment helpful', regex=True)</span>
).any(axis=1)
print(df_all[<span class="hljs-string">mask</span>][<span class="hljs-symbol">'condition'</span>].head(5))
</code></pre>
<pre><code><span class="hljs-number">105</span>     <span class="hljs-number">2</span>&lt;/span&gt; users found <span class="hljs-keyword">this</span> comment helpful.
<span class="hljs-number">196</span>     <span class="hljs-number">4</span>&lt;/span&gt; users found <span class="hljs-keyword">this</span> comment helpful.
<span class="hljs-number">243</span>     <span class="hljs-number">3</span>&lt;/span&gt; users found <span class="hljs-keyword">this</span> comment helpful.
<span class="hljs-number">264</span>     <span class="hljs-number">4</span>&lt;/span&gt; users found <span class="hljs-keyword">this</span> comment helpful.
<span class="hljs-number">391</span>    <span class="hljs-number">11</span>&lt;/span&gt; users found <span class="hljs-keyword">this</span> comment helpful.
Name: condition, dtype: <span class="hljs-keyword">object</span>
</code></pre><pre><code class="lang-python">df_all<span class="hljs-selector-class">.loc</span>[<span class="hljs-attribute">mask</span>, <span class="hljs-string">'condition'</span>] = <span class="hljs-string">'Other'</span>
</code></pre>
<pre><code class="lang-python"><span class="hljs-attr">n_drugs</span> = <span class="hljs-number">21</span>
<span class="hljs-attr">top_conditions</span> = df_all.groupby(['condition'])[
    'drugName'].nunique().sort_values(<span class="hljs-attr">ascending=False)[1:n_drugs].index</span>
<span class="hljs-attr">condition_frequencies</span> = df_all.groupby(['condition'])[
    'drugName'].nunique().sort_values(<span class="hljs-attr">ascending=False)[1:n_drugs].values</span>
fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
fig.tight_layout()
hist(condition_frequencies, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=top_conditions,</span> <span class="hljs-attr">colmap='viridis',</span> <span class="hljs-attr">xlabel='condition',</span>
     <span class="hljs-attr">title='Top</span> {<span class="hljs-number">0</span>:d} most frequent conditions that are aimed to be treated by drugs'.format(
         n_drugs-<span class="hljs-number">1</span>),
     <span class="hljs-attr">density=False,</span> <span class="hljs-attr">rot=45)</span>

plt.show()
</code></pre>
<p><img src="output_42_0.png" alt="png"></p>
<pre><code class="lang-python"><span class="hljs-attr">usefulCounts</span> = df_all.groupby('usefulCount')['usefulCount'].count().index
<span class="hljs-attr">usefulCount_frequencies</span> = df_all.groupby(
    'usefulCount')['usefulCount'].count().values
fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(16,</span> <span class="hljs-number">6</span>), <span class="hljs-attr">sharey=False)</span>
fig.tight_layout()
hist(usefulCount_frequencies, <span class="hljs-attr">fig=fig,</span> <span class="hljs-attr">ax=ax,</span> <span class="hljs-attr">labels=usefulCounts,</span> <span class="hljs-attr">colmap='viridis',</span>
     <span class="hljs-attr">xlabel='Number</span> of people that found the review useful',
     <span class="hljs-attr">dist_plot=True,</span> <span class="hljs-attr">colbar=True,</span> <span class="hljs-attr">title='Distribution</span> of the reviews', <span class="hljs-attr">density=False,</span> <span class="hljs-attr">rot=0)</span>

plt.show()
</code></pre>
<p><img src="output_43_0.png" alt="png"></p>
<pre><code class="lang-python"><span class="hljs-selector-tag">df_all</span><span class="hljs-selector-attr">["usefulCount"]</span><span class="hljs-selector-class">.describe</span>()
</code></pre>
<pre><code><span class="hljs-selector-tag">count</span>   215063<span class="hljs-selector-class">.000</span>
<span class="hljs-selector-tag">mean</span>        28<span class="hljs-selector-class">.001</span>
<span class="hljs-selector-tag">std</span>         36<span class="hljs-selector-class">.346</span>
<span class="hljs-selector-tag">min</span>          0<span class="hljs-selector-class">.000</span>
25%          6<span class="hljs-selector-class">.000</span>
50%         16<span class="hljs-selector-class">.000</span>
75%         36<span class="hljs-selector-class">.000</span>
<span class="hljs-selector-tag">max</span>       1291<span class="hljs-selector-class">.000</span>
<span class="hljs-selector-tag">Name</span>: <span class="hljs-selector-tag">usefulCount</span>, <span class="hljs-selector-tag">dtype</span>: <span class="hljs-selector-tag">float64</span>
</code></pre><p>Looking at the <code>review</code> can also reveal some useful information:</p>
<pre><code class="lang-python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):
    <span class="hljs-keyword">print</span>(<span class="hljs-string">'{0:s}\n'</span>.<span class="hljs-keyword">format</span>(df_train[<span class="hljs-string">'review'</span>][i]))
</code></pre>
<pre><code>"It has no side effect, I <span class="hljs-keyword">take</span> it <span class="hljs-keyword">in</span> combination <span class="hljs-keyword">of</span> Bystolic 5 Mg <span class="hljs-keyword">and</span> Fish Oil"

"My son <span class="hljs-keyword">is</span> halfway through his fourth week <span class="hljs-keyword">of</span> Intuniv. We became concerned when he began this last week, when he started taking the highest dose he will <span class="hljs-keyword">be</span> on. For two days, he could hardly get out <span class="hljs-keyword">of</span> bed, was very cranky, <span class="hljs-keyword">and</span> slept <span class="hljs-keyword">for</span> nearly 8 hours on a drive home <span class="hljs-keyword">from</span> school vacation (very unusual <span class="hljs-keyword">for</span> him.) I called his doctor on Monday morning <span class="hljs-keyword">and</span> she said to stick it out a few days. See how he did at school, <span class="hljs-keyword">and</span> with getting up <span class="hljs-keyword">in</span> the morning. The last two days have been problem free. He <span class="hljs-keyword">is</span> MUCH more agreeable than ever. He <span class="hljs-keyword">is</span> less emotional (a good thing), less cranky. He <span class="hljs-keyword">is</span> remembering all the things he should. Overall his behavior <span class="hljs-keyword">is</span> better. 
We have tried many different medications <span class="hljs-keyword">and</span> so far this <span class="hljs-keyword">is</span> the most effective."

"I used to <span class="hljs-keyword">take</span> another oral contraceptive, which had 21 pill cycle, <span class="hljs-keyword">and</span> was very happy- very light periods, max 5 days, no other side effects. But it contained hormone gestodene, which <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> available <span class="hljs-keyword">in</span> US, so I switched to Lybrel, because the ingredients are similar. When my other pills ended, I started Lybrel immediately, on my first day <span class="hljs-keyword">of</span> period, <span class="hljs-keyword">as</span> the instructions said. And the period lasted <span class="hljs-keyword">for</span> two weeks. When taking the second pack- same two weeks. And <span class="hljs-keyword">now</span>, with third pack things got even worse- my third period lasted <span class="hljs-keyword">for</span> two weeks <span class="hljs-keyword">and</span> <span class="hljs-keyword">now</span> it&amp;#039;s the <span class="hljs-keyword">end</span> <span class="hljs-keyword">of</span> the third week- I still have daily brown discharge.
The positive side <span class="hljs-keyword">is</span> <span class="hljs-keyword">that</span> I didn&amp;#039;t have any other side effects. The idea <span class="hljs-keyword">of</span> <span class="hljs-keyword">being</span> period free was so tempting... Alas."
</code></pre><h3 id="cleaning-and-normalizing-the-text-for-sentiment-analysis">Cleaning and normalizing the text for sentiment analysis</h3>
<p><strong>stopwords</strong> are words that we do not want them taking up space in our database, or taking up valuable processing time. For this, we can remove them easily by storing a list of words that we consider to be stop words. Even though when it comes to <strong><em>sentiment analysis</em></strong>, the popular opinion is to remove <strong>stopwords</strong>, removing them is <strong>not always the best idea, especially if the context of the phrases may influence the performance of the algorithm</strong>. </p>
<p>For now we will remove the <strong>stopwords</strong> from <code>review</code> column but we first make sure that the ones that carry an emotional meaning are not removed as they are important for <strong><em>sentiment analysis</em></strong>; For example, there are many words (see below) with <strong>negative connotation</strong> that are required to be <strong>removed them from the <code>stopWords</code></strong>:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">aren&#39;t</td>
<td style="text-align:center">haven&#39;t</td>
<td style="text-align:center">not</td>
</tr>
<tr>
<td style="text-align:center">couldn&#39;t</td>
<td style="text-align:center">isn&#39;t</td>
<td style="text-align:center">can&#39;t</td>
</tr>
<tr>
<td style="text-align:center">didn&#39;t</td>
<td style="text-align:center">mightn&#39;t</td>
<td style="text-align:center">shan&#39;t</td>
</tr>
<tr>
<td style="text-align:center">doesn&#39;t</td>
<td style="text-align:center">mustn&#39;t</td>
<td style="text-align:center">shouldn&#39;t</td>
</tr>
<tr>
<td style="text-align:center">don&#39;t</td>
<td style="text-align:center">needn&#39;t</td>
<td style="text-align:center">wasn&#39;t</td>
</tr>
<tr>
<td style="text-align:center">hadn&#39;t</td>
<td style="text-align:center">no</td>
<td style="text-align:center">weren&#39;t</td>
</tr>
<tr>
<td style="text-align:center">hasn&#39;t</td>
<td style="text-align:center">nor</td>
<td style="text-align:center">wouldn&#39;t</td>
</tr>
</tbody>
</table>
<p>We can always compare the accuracy of the model when the stopwords are included and otherwise.</p>
<p>There are some other issues as a result of webscraping, e.g., there are some encoding issues that need to be resolved prior to sentiment analysis e.g. <code>&#39;</code> is displayed as <code>&amp;#039;</code>. We resolve those issues using the &#39;html.parser&#39; of <code>BeautifulSoup</code>. </p>
<p>We then need to <strong>tokenize</strong> the <strong>reviews</strong>, i.e. <em>break it up to pieces</em> such as <strong>words, keywords, phrases, symbols</strong> etc.</p>
<p>We can either define our own function and use our own <em>ignore these words</em> dictionary or since there are a lot of words that have to be added to the list of <strong>stopwords</strong>, we can take advantage of <code>nltk</code>&#39;s <strong>stopwords</strong> library.</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> string
<span class="hljs-keyword">from</span> wordcloud <span class="hljs-keyword">import</span> WordCloud, STOPWORDS
<span class="hljs-keyword">import</span> nltk
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> nltk <span class="hljs-keyword">import</span> PorterStemmer <span class="hljs-keyword">as</span> Porter_stemmer
<span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords
<span class="hljs-keyword">from</span> nltk.stem.snowball <span class="hljs-keyword">import</span> SnowballStemmer
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
Snowball_stemmer = SnowballStemmer(<span class="hljs-string">'english'</span>)
nltk_stopwords = stopwords.words(<span class="hljs-string">'english'</span>)
stopWords = STOPWORDS.union(nltk_stopwords)
remove_from_stopWords = [<span class="hljs-string">"aren't"</span>, <span class="hljs-string">"couldn't"</span>, <span class="hljs-string">"didn't"</span>, <span class="hljs-string">"doesn't"</span>, <span class="hljs-string">"don't"</span>, <span class="hljs-string">"hadn't"</span>, <span class="hljs-string">"hasn't"</span>,
                         <span class="hljs-string">"haven't"</span>, <span class="hljs-string">"isn't"</span>, <span class="hljs-string">"mightn't"</span>, <span class="hljs-string">"mustn't"</span>, <span class="hljs-string">"needn't"</span>, <span class="hljs-string">"no"</span>, <span class="hljs-string">"nor"</span>, <span class="hljs-string">"not"</span>,
                         <span class="hljs-string">"can't"</span>, <span class="hljs-string">"shan't"</span>, <span class="hljs-string">"shouldn't"</span>, <span class="hljs-string">"wasn't"</span>, <span class="hljs-string">"weren't"</span>, <span class="hljs-string">"wouldn't"</span>]
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> remove_from_stopWords:
    stopWords.remove(i)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">clean_review</span><span class="hljs-params">(raw_review, stopWords=stopWords, stemmer=Snowball_stemmer)</span>:</span>

    <span class="hljs-comment"># 1. Remove HTML characters</span>
    review_text = BeautifulSoup(raw_review, <span class="hljs-string">'html.parser'</span>).get_text()

    <span class="hljs-comment"># 2. Make a space</span>
    letters_only = re.sub(<span class="hljs-string">'[^a-zA-Z]'</span>, <span class="hljs-string">' '</span>, review_text)

    <span class="hljs-comment"># 3. lower letters</span>
    words = letters_only.lower().split()

    <span class="hljs-comment"># 4. Stopwords</span>
    meaningfulWords = [w <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> words <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> w <span class="hljs-keyword">in</span> stopWords]

    <span class="hljs-comment"># 5. Stemming</span>
    stemming_words = [stemmer.stem(w) <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> meaningfulWords]

    <span class="hljs-comment"># 6. space join words and return</span>
    <span class="hljs-keyword">return</span>(<span class="hljs-string">' '</span>.join(stemming_words))
</code></pre>
<p>We will also define a simple functions to generate <a href="https://kavita-ganesan.com/what-are-n-grams/#.XzP6tBNKgUE"><em>n-grams</em></a></p>
<pre><code class="lang-python">def gen_n_grams(<span class="hljs-keyword">sentence</span>, n=<span class="hljs-number">4</span>, stopWords=stopWords):
    <span class="hljs-keyword">token</span> = [<span class="hljs-keyword">token</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">token</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">sentence</span>.<span class="hljs-built_in">lower</span>().<span class="hljs-built_in">split</span>(
        <span class="hljs-string">' '</span>) <span class="hljs-keyword">if</span> <span class="hljs-keyword">token</span> != <span class="hljs-string">''</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">token</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stopWords]
    n_grams = zip(*[<span class="hljs-keyword">token</span>[i:] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n)])
    <span class="hljs-literal">return</span> [<span class="hljs-string">' '</span>.join(gram) <span class="hljs-keyword">for</span> gram <span class="hljs-keyword">in</span> n_grams]
</code></pre>
<pre><code class="lang-python">print('{0:s}\n'.format(df_train[<span class="hljs-string">'review'</span>][<span class="hljs-symbol">106</span>]))
</code></pre>
<pre><code>"So far loving this. Stomach pain has almost disappeared, haven&amp;<span class="hljs-comment">#039;t had an attack in over a week. Down side is have to be near a bathroom about an hour after taking it but that is manageable. Hopefully it continues to work. Time will tell."</span>
</code></pre><pre><code class="lang-python">% % time
print(clean<span class="hljs-emphasis">_review(df_</span>train[<span class="hljs-string">'review'</span>][<span class="hljs-symbol">106</span>]))
</code></pre>
<pre><code>far love stomach pain almost disappear attack week side near bathroom hour take manag hope continu work time tell
CPU times: <span class="hljs-keyword">user</span> <span class="hljs-title">1</span>.<span class="hljs-number">72</span> ms, sys: <span class="hljs-number">632</span> s, total: <span class="hljs-number">2.35</span> <span class="hljs-keyword">ms</span>
<span class="hljs-title">Wall</span> time: <span class="hljs-number">2.19</span> ms
</code></pre><p>We can visualize the most frequent words using a custom function <code>cloud_of_words</code> (from <a href="https://amueller.github.io/word_cloud/generated/wordcloud.WordCloud.html">WordCloud</a>)</p>
<p>in $\color{green}{\textbf{good}}$</p>
<pre><code class="lang-python">cloud_of_words(<span class="hljs-name">df_all_good</span>['review'], stopWords=stopWords,
               title='frequent words in good reviews', colormap='rainbow')
</code></pre>
<p><img src="output_56_0.png" alt="png"></p>
<p>and in $\color{red}{\textbf{bad}}$ reviews</p>
<pre><code class="lang-python">cloud_of_words(<span class="hljs-name">df_all_bad</span>['review'], stopWords=stopWords,
               title='frequent words in good reviews', colormap='rainbow')
</code></pre>
<p><img src="output_58_0.png" alt="png"></p>
<h3 id="most-frequent-4-grams">Most frequent 4-grams</h3>
<pre><code class="lang-python"><span class="hljs-built_in">from</span> collections import defaultdict
frequency_dict = defaultdict(int)
clean_frequency_dict = defaultdict(int)
<span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> df_all_good[<span class="hljs-string">'review'</span>]:
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> gen_n_grams(review):
        frequency_dict[<span class="hljs-built_in">word</span>] += <span class="hljs-number">1</span>
<span class="hljs-keyword">for</span> cleaned_review <span class="hljs-keyword">in</span> df_all_good[<span class="hljs-string">'review'</span>].apply(clean_review):
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> gen_n_grams(cleaned_review):
        clean_frequency_dict[<span class="hljs-built_in">word</span>] += <span class="hljs-number">1</span>
good_sorted = sorted(frequency_dict.<span class="hljs-keyword">items</span>(), key=lambda x: x[<span class="hljs-number">1</span>], reverse=True)
good_sorted_clean = sorted(
    clean_frequency_dict.<span class="hljs-keyword">items</span>(), key=lambda x: x[<span class="hljs-number">1</span>], reverse=True)
</code></pre>
<pre><code class="lang-python">fig, <span class="hljs-built_in">axes</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">5</span>))
hor_bar(good_sorted[:<span class="hljs-number">5</span>], <span class="hljs-built_in">axes</span>[<span class="hljs-number">0</span>], fig, <span class="hljs-built_in">color</span>=<span class="hljs-string">"#00e68a"</span>,
        <span class="hljs-built_in">title</span>='Raw reviews', fontSize=<span class="hljs-number">16</span>)
hor_bar(good_sorted_clean[:<span class="hljs-number">5</span>], <span class="hljs-built_in">axes</span>[<span class="hljs-number">1</span>], fig,
        <span class="hljs-built_in">color</span>=<span class="hljs-string">"#00e68a"</span>, <span class="hljs-built_in">title</span>='Cleaned reviews', fontSize=<span class="hljs-number">16</span>)
plt.suptitle('The most frequent <span class="hljs-number">4</span>-grams <span class="hljs-keyword">in</span> good reviews', fontsize=<span class="hljs-number">20</span>)
fig.tight_layout(pad=<span class="hljs-number">4</span>)
plt.<span class="hljs-built_in">show</span>()
</code></pre>
<p><img src="output_61_0.png" alt="png"></p>
<pre><code class="lang-python"><span class="hljs-built_in">from</span> collections import defaultdict
frequency_dict = defaultdict(int)
clean_frequency_dict = defaultdict(int)
<span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> df_all_bad[<span class="hljs-string">'review'</span>]:
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> gen_n_grams(review):
        frequency_dict[<span class="hljs-built_in">word</span>] += <span class="hljs-number">1</span>
<span class="hljs-keyword">for</span> cleaned_review <span class="hljs-keyword">in</span> df_all_bad[<span class="hljs-string">'review'</span>].apply(clean_review):
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> gen_n_grams(cleaned_review):
        clean_frequency_dict[<span class="hljs-built_in">word</span>] += <span class="hljs-number">1</span>
bad_sorted = sorted(frequency_dict.<span class="hljs-keyword">items</span>(), key=lambda x: x[<span class="hljs-number">1</span>], reverse=True)
bad_sorted_clean = sorted(clean_frequency_dict.<span class="hljs-keyword">items</span>(),
                          key=lambda x: x[<span class="hljs-number">1</span>], reverse=True)
</code></pre>
<pre><code class="lang-python">fig, <span class="hljs-built_in">axes</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">5</span>))
hor_bar(bad_sorted[:<span class="hljs-number">5</span>], <span class="hljs-built_in">axes</span>[<span class="hljs-number">0</span>], fig, <span class="hljs-built_in">color</span>=<span class="hljs-string">"#ff0000"</span>,
        <span class="hljs-built_in">title</span>='Raw reviews', fontSize=<span class="hljs-number">16</span>)
hor_bar(bad_sorted_clean[:<span class="hljs-number">5</span>], <span class="hljs-built_in">axes</span>[<span class="hljs-number">1</span>], fig,
        <span class="hljs-built_in">color</span>=<span class="hljs-string">"#ff0000"</span>, <span class="hljs-built_in">title</span>='Cleaned reviews', fontSize=<span class="hljs-number">16</span>)
plt.suptitle('Most frequent <span class="hljs-number">4</span>-grams <span class="hljs-keyword">in</span> bad reviews', fontsize=<span class="hljs-number">20</span>)
fig.tight_layout(pad=<span class="hljs-number">4</span>)
plt.<span class="hljs-built_in">show</span>()
</code></pre>
<p><img src="output_63_0.png" alt="png"></p>
<pre><code class="lang-python"><span class="hljs-built_in">from</span> collections import defaultdict
frequency_dict = defaultdict(int)
<span class="hljs-keyword">for</span> <span class="hljs-keyword">sentence</span> <span class="hljs-keyword">in</span> df_all_bad[<span class="hljs-string">'review'</span>]:
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> gen_n_grams(<span class="hljs-keyword">sentence</span>):
        frequency_dict[<span class="hljs-built_in">word</span>] += <span class="hljs-number">1</span>
</code></pre>
<pre><code class="lang-python">fig, <span class="hljs-attr">ax</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-attr">figsize=(5,</span> <span class="hljs-number">4</span>))
<span class="hljs-attr">bad_sorted</span> = sorted(frequency_dict.items(), <span class="hljs-attr">key=lambda</span> x: x[<span class="hljs-number">1</span>], <span class="hljs-attr">reverse=True)</span>
hor_bar(bad_sorted[:<span class="hljs-number">10</span>], ax, fig, <span class="hljs-attr">color="#ff0000",</span>
        <span class="hljs-attr">title='The</span> most frequent <span class="hljs-number">4</span>-grams <span class="hljs-keyword">in</span> bad reviews', <span class="hljs-attr">fontSize=20)</span>
plt.show()
</code></pre>
<p><img src="output_65_0.png" alt="png"></p>
<h1 id="building-the-sentiment-analysis-model">Building the sentiment analysis model</h1>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> gensim
from scipy.stats.stats <span class="hljs-keyword">import</span> pearsonr
<span class="hljs-keyword">import</span> scrapy
<span class="hljs-keyword">import</span> spacy
<span class="hljs-keyword">import</span> dill
from sklearn <span class="hljs-keyword">import</span> model_selection, preprocessing, metrics, ensemble, naive_bayes, linear_model
from sklearn.feature_extraction.<span class="hljs-keyword">text</span> <span class="hljs-keyword">import</span> TfidfVectorizer, CountVectorizer
from sklearn.decomposition <span class="hljs-keyword">import</span> TruncatedSVD
from sklearn.pipeline <span class="hljs-keyword">import</span> Pipeline
from sklearn.feature_extraction.<span class="hljs-keyword">text</span> <span class="hljs-keyword">import</span> CountVectorizer
from sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">import</span> lightgbm <span class="hljs-keyword">as</span> lgb
from bs4 <span class="hljs-keyword">import</span> BeautifulSoup
from keras.preprocessing.<span class="hljs-keyword">text</span> <span class="hljs-keyword">import</span> Tokenizer
from keras.preprocessing.sequence <span class="hljs-keyword">import</span> pad_sequences
from keras.layers <span class="hljs-keyword">import</span> Dense, Input, LSTM, Embedding, Dropout, Activation, CuDNNGRU, Conv1D
from keras.layers <span class="hljs-keyword">import</span> Bidirectional, GlobalMaxPool1D
from keras.models <span class="hljs-keyword">import</span> Model
from keras <span class="hljs-keyword">import</span> initializers, regularizers, constraints, optimizers, layers
<span class="hljs-keyword">import</span> logging  # Setting up the loggings to monitor gensim
logging.basicConfig(format=<span class="hljs-string">"%(levelname)s - %(asctime)s: %(message)s"</span>,
                    datefmt=<span class="hljs-string">'%H:%M:%S'</span>, level=logging.INFO)
pd.options.mode.chained_assignment = None
pd.options.display.max_columns = <span class="hljs-number">999</span>
word_model = gensim.models.Word2Vec.load(<span class="hljs-string">"data/word_model_gensim.model"</span>)
</code></pre>
<pre><code>/Users/Ali/miniconda3/lib/python3<span class="hljs-number">.6</span>/site<span class="hljs-params">-packages</span>/h5py/__init__.py:<span class="hljs-number">36</span>: FutureWarning: Conversion of the second argument of issubdtype from <span class="hljs-string">`float`</span> <span class="hljs-keyword">to</span> <span class="hljs-string">`np.floating`</span> is deprecated. <span class="hljs-keyword">In</span> future, it will be treated as <span class="hljs-string">`np.float64 == np.dtype(float).type`</span>.
  from ._conv <span class="hljs-keyword">import</span> register_converters as _register_converters
Using TensorFlow backend.
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">36</span>: loading Word2Vec object from <span class="hljs-built_in">data</span>/word_model_gensim.model
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">36</span>: loading wv recursively from <span class="hljs-built_in">data</span>/word_model_gensim.model.wv.* <span class="hljs-keyword">with</span> mmap=<span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">36</span>: loading vectors_ngrams from <span class="hljs-built_in">data</span>/word_model_gensim.model.wv.vectors_ngrams.npy <span class="hljs-keyword">with</span> mmap=<span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>: setting ignored attribute vectors_norm <span class="hljs-keyword">to</span> <span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>: setting ignored attribute vectors_vocab_norm <span class="hljs-keyword">to</span> <span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>: setting ignored attribute vectors_ngrams_norm <span class="hljs-keyword">to</span> <span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>: setting ignored attribute buckets_word <span class="hljs-keyword">to</span> <span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>: loading vocabulary recursively from <span class="hljs-built_in">data</span>/word_model_gensim.model.vocabulary.* <span class="hljs-keyword">with</span> mmap=<span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>: loading trainables recursively from <span class="hljs-built_in">data</span>/word_model_gensim.model.trainables.* <span class="hljs-keyword">with</span> mmap=<span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">38</span>: loading vectors_ngrams_lockf from <span class="hljs-built_in">data</span>/word_model_gensim.model.trainables.vectors_ngrams_lockf.npy <span class="hljs-keyword">with</span> mmap=<span class="hljs-literal">None</span>
INFO - <span class="hljs-number">13</span>:<span class="hljs-number">36</span>:<span class="hljs-number">39</span>: loaded <span class="hljs-built_in">data</span>/word_model_gensim.model
</code></pre><pre><code class="lang-python"><span class="hljs-keyword">import</span> dill
df_all = dill.load(<span class="hljs-built_in">open</span>(<span class="hljs-string">'data/df_all.pkd'</span>, <span class="hljs-string">'rb'</span>))
</code></pre>
<pre><code class="lang-python">dill.dump(df_all, <span class="hljs-keyword">open</span>(<span class="hljs-symbol">'df_all</span>.pkd',<span class="hljs-symbol">'wb'</span>))
</code></pre>
<h4 id="create-amapping-between-conditions-and-drugs">Create amapping between conditions and drugs</h4>
<pre><code class="lang-python"><span class="hljs-selector-tag">df_all</span><span class="hljs-selector-class">.head</span>()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uniqueID</th>
      <th>drugName</th>
      <th>condition</th>
      <th>review</th>
      <th>rating</th>
      <th>date</th>
      <th>usefulCount</th>
      <th>year</th>
      <th>month</th>
      <th>sentiment</th>
      <th>weighted_by_count_rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>206461</td>
      <td>Valsartan</td>
      <td>Left Ventricular Dysfunction</td>
      <td>&quot;It has no side effect, I take it in combinati...</td>
      <td>9</td>
      <td>2012-05-20</td>
      <td>27</td>
      <td>2012</td>
      <td>5</td>
      <td>1</td>
      <td>243</td>
    </tr>
    <tr>
      <th>1</th>
      <td>95260</td>
      <td>Guanfacine</td>
      <td>ADHD</td>
      <td>&quot;My son is halfway through his fourth week of ...</td>
      <td>8</td>
      <td>2010-04-27</td>
      <td>192</td>
      <td>2010</td>
      <td>4</td>
      <td>1</td>
      <td>1536</td>
    </tr>
    <tr>
      <th>2</th>
      <td>92703</td>
      <td>Lybrel</td>
      <td>Birth Control</td>
      <td>&quot;I used to take another oral contraceptive, wh...</td>
      <td>5</td>
      <td>2009-12-14</td>
      <td>17</td>
      <td>2009</td>
      <td>12</td>
      <td>0</td>
      <td>85</td>
    </tr>
    <tr>
      <th>3</th>
      <td>138000</td>
      <td>Ortho Evra</td>
      <td>Birth Control</td>
      <td>&quot;This is my first time using any form of birth...</td>
      <td>8</td>
      <td>2015-11-03</td>
      <td>10</td>
      <td>2015</td>
      <td>11</td>
      <td>1</td>
      <td>80</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35696</td>
      <td>Buprenorphine / naloxone</td>
      <td>Opiate Dependence</td>
      <td>&quot;Suboxone has completely turned my life around...</td>
      <td>9</td>
      <td>2016-11-27</td>
      <td>37</td>
      <td>2016</td>
      <td>11</td>
      <td>1</td>
      <td>333</td>
    </tr>
  </tbody>
</table>
</div>




<pre><code class="lang-python"><span class="hljs-keyword">new</span><span class="hljs-type">_df</span> = pd.DataFrame()
<span class="hljs-keyword">for</span> j, drug <span class="hljs-keyword">in</span> enumerate(sorted(list(df_all[<span class="hljs-string">'drugName'</span>].unique()))):<span class="hljs-type"></span>
</code></pre>
<pre><code class="lang-python">groups = df.groupby(by=[<span class="hljs-string">'A'</span>])
print(groups.apply(lambda g: g[g[<span class="hljs-string">'B'</span>] == g[<span class="hljs-string">'B'</span>].max()]))
.agg([<span class="hljs-string">'mean'</span>, <span class="hljs-string">'sum'</span>,<span class="hljs-string">'count'</span>])
</code></pre>
<pre><code class="lang-python">groups = df_all[[<span class="hljs-string">'condition'</span>,<span class="hljs-string">'drugName'</span>,<span class="hljs-string">'rating'</span>,<span class="hljs-string">'sentiment'</span>,<span class="hljs-string">'usefulCount'</span>]].groupby([<span class="hljs-string">'condition'</span>,<span class="hljs-string">'drugName'</span>])
</code></pre>
<pre><code class="lang-python">groups.agg([<span class="hljs-string">'count'</span>,<span class="hljs-string">'mean'</span>])[groups.apply(lambda g: g[<span class="hljs-string">'rating'</span>].count()&gt;<span class="hljs-number">2</span>).values]
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">rating</th>
      <th colspan="2" halign="left">sentiment</th>
      <th colspan="2" halign="left">usefulCount</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>count</th>
      <th>mean</th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>condition</th>
      <th>drugName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">ADHD</th>
      <th>Adderall</th>
      <td>227</td>
      <td>8.224670</td>
      <td>227</td>
      <td>0.876652</td>
      <td>227</td>
      <td>44.004405</td>
    </tr>
    <tr>
      <th>Adderall XR</th>
      <td>139</td>
      <td>8.266187</td>
      <td>139</td>
      <td>0.892086</td>
      <td>139</td>
      <td>29.402878</td>
    </tr>
    <tr>
      <th>Adzenys XR-ODT</th>
      <td>21</td>
      <td>5.952381</td>
      <td>21</td>
      <td>0.571429</td>
      <td>21</td>
      <td>8.571429</td>
    </tr>
    <tr>
      <th>Amantadine</th>
      <td>3</td>
      <td>8.666667</td>
      <td>3</td>
      <td>1.000000</td>
      <td>3</td>
      <td>15.666667</td>
    </tr>
    <tr>
      <th>Amphetamine</th>
      <td>54</td>
      <td>6.518519</td>
      <td>54</td>
      <td>0.666667</td>
      <td>54</td>
      <td>9.333333</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">von Willebrand&#39;s Disease</th>
      <th>Desmopressin</th>
      <td>3</td>
      <td>10.000000</td>
      <td>3</td>
      <td>1.000000</td>
      <td>3</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>Stimate</th>
      <td>3</td>
      <td>10.000000</td>
      <td>3</td>
      <td>1.000000</td>
      <td>3</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">zen Shoulde</th>
      <th>Diclofenac</th>
      <td>5</td>
      <td>7.400000</td>
      <td>5</td>
      <td>0.800000</td>
      <td>5</td>
      <td>17.800000</td>
    </tr>
    <tr>
      <th>Nabumetone</th>
      <td>3</td>
      <td>5.666667</td>
      <td>3</td>
      <td>0.666667</td>
      <td>3</td>
      <td>31.333333</td>
    </tr>
    <tr>
      <th>Naproxen</th>
      <td>4</td>
      <td>2.250000</td>
      <td>4</td>
      <td>0.000000</td>
      <td>4</td>
      <td>12.000000</td>
    </tr>
  </tbody>
</table>
<p>4868 rows  6 columns</p>
</div>




<pre><code class="lang-python">groups.agg([<span class="hljs-string">'count'</span>,<span class="hljs-string">'mean'</span>])[groups.apply(lambda <span class="hljs-variable">g:</span> g[<span class="hljs-string">'rating'</span>].<span class="hljs-built_in">count</span>()&gt;<span class="hljs-number">2</span>).<span class="hljs-built_in">values</span>].to_csv(<span class="hljs-string">'drugs_compact_test.csv'</span>, <span class="hljs-built_in">index</span>=True)
</code></pre>
<pre><code class="lang-python">group2 = df_all[[<span class="hljs-string">'condition'</span>,<span class="hljs-string">'drugName'</span>,<span class="hljs-string">'rating'</span>,<span class="hljs-string">'sentiment'</span>,<span class="hljs-string">'usefulCount'</span>]].groupby([<span class="hljs-string">'drugName'</span>,<span class="hljs-string">'condition'</span>])
</code></pre>
<pre><code class="lang-python">group2.agg([<span class="hljs-string">'count'</span>,<span class="hljs-string">'mean'</span>])[group2.apply(lambda g: g[<span class="hljs-string">'rating'</span>].count()&gt;<span class="hljs-number">2</span>).values]
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">rating</th>
      <th colspan="2" halign="left">sentiment</th>
      <th colspan="2" halign="left">usefulCount</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>count</th>
      <th>mean</th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>drugName</th>
      <th>condition</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Abacavir / dolutegravir / lamivudine</th>
      <th>HIV Infection</th>
      <td>70</td>
      <td>8.414286</td>
      <td>70</td>
      <td>0.814286</td>
      <td>70</td>
      <td>12.871429</td>
    </tr>
    <tr>
      <th>Abacavir / lamivudine</th>
      <th>HIV Infection</th>
      <td>3</td>
      <td>10.000000</td>
      <td>3</td>
      <td>1.000000</td>
      <td>3</td>
      <td>3.666667</td>
    </tr>
    <tr>
      <th>Abatacept</th>
      <th>Rheumatoid Arthritis</th>
      <td>23</td>
      <td>7.000000</td>
      <td>23</td>
      <td>0.652174</td>
      <td>23</td>
      <td>49.260870</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Abilify</th>
      <th>Agitated State</th>
      <td>22</td>
      <td>6.409091</td>
      <td>22</td>
      <td>0.681818</td>
      <td>22</td>
      <td>33.136364</td>
    </tr>
    <tr>
      <th>Autism</th>
      <td>18</td>
      <td>7.000000</td>
      <td>18</td>
      <td>0.666667</td>
      <td>18</td>
      <td>63.444444</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Zytiga</th>
      <th>Prostate Cance</th>
      <td>12</td>
      <td>9.250000</td>
      <td>12</td>
      <td>0.916667</td>
      <td>12</td>
      <td>35.250000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Zyvox</th>
      <th>Methicillin-Resistant Staphylococcus Aureus Infection</th>
      <td>12</td>
      <td>9.083333</td>
      <td>12</td>
      <td>1.000000</td>
      <td>12</td>
      <td>21.916667</td>
    </tr>
    <tr>
      <th>Skin and Structure Infection</th>
      <td>7</td>
      <td>8.285714</td>
      <td>7</td>
      <td>0.857143</td>
      <td>7</td>
      <td>18.000000</td>
    </tr>
    <tr>
      <th>ZzzQuil</th>
      <th>Insomnia</th>
      <td>3</td>
      <td>2.000000</td>
      <td>3</td>
      <td>0.000000</td>
      <td>3</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>ella</th>
      <th>Emergency Contraception</th>
      <td>71</td>
      <td>7.183099</td>
      <td>71</td>
      <td>0.718310</td>
      <td>71</td>
      <td>9.535211</td>
    </tr>
  </tbody>
</table>
<p>4868 rows  6 columns</p>
</div>




<pre><code class="lang-python">group2.agg([<span class="hljs-string">'count'</span>,<span class="hljs-string">'mean'</span>])[group2.apply(lambda <span class="hljs-variable">g:</span> g[<span class="hljs-string">'rating'</span>].<span class="hljs-built_in">count</span>()&gt;<span class="hljs-number">2</span>).<span class="hljs-built_in">values</span>].to_csv(<span class="hljs-string">'drugs_compact_test2.csv'</span>, <span class="hljs-built_in">index</span>=True)
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">from collections import defaultdict
drug_popularity_dict = {}
condition_popularity_dict = {}

for j, drug in enumerate(sorted(list(df_all[<span class="hljs-string">'drugName'</span>].unique()))):
    sum_uf = list(df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].\
                  groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'usefulCount'</span>].sum())

    conditions = list(df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].\
                      groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'weighted_by_count_rating'</span>].sum().index)

    popularity = list(df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].\
                      groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'weighted_by_count_rating'</span>].count()/\
                      df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].\
                      groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'weighted_by_count_rating'</span>].count().sum())
    counts = list(df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'usefulCount'</span>].count())

    normalized_rating = list(df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].\
                             groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'rating'</span>].mean())

    weighted_rating = list(df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].\
                             groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'weighted_by_count_rating'</span>].sum()/\
                             df_all[df_all[<span class="hljs-string">'drugName'</span>]==drug].\
                             groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'usefulCount'</span>].sum())
    drug_popularity_dict[drug] = {}
    for i, condition in enumerate(conditions):
        if condition not in condition_popularity_dict.keys():
            condition_popularity_dict[condition]={}

        drug_popularity_dict[drug][condition]=
        [popularity[i], normalized_rating[i], weighted_rating[i], counts[i]]
        condition_popularity_dict[condition][drug]=
        [popularity[i], normalized_rating[i], weighted_rating[i], counts[i], sum_uf[i]]
</code></pre>
<h4 id="dump-the-dictionaries">dump the dictionaries</h4>
<pre><code class="lang-python"><span class="hljs-selector-tag">df_all</span><span class="hljs-selector-class">.head</span>()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uniqueID</th>
      <th>drugName</th>
      <th>condition</th>
      <th>review</th>
      <th>rating</th>
      <th>date</th>
      <th>usefulCount</th>
      <th>year</th>
      <th>month</th>
      <th>sentiment</th>
      <th>weighted_by_count_rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>206461</td>
      <td>Valsartan</td>
      <td>Left Ventricular Dysfunction</td>
      <td>&quot;It has no side effect, I take it in combinati...</td>
      <td>9</td>
      <td>2012-05-20</td>
      <td>27</td>
      <td>2012</td>
      <td>5</td>
      <td>1</td>
      <td>243</td>
    </tr>
    <tr>
      <th>1</th>
      <td>95260</td>
      <td>Guanfacine</td>
      <td>ADHD</td>
      <td>&quot;My son is halfway through his fourth week of ...</td>
      <td>8</td>
      <td>2010-04-27</td>
      <td>192</td>
      <td>2010</td>
      <td>4</td>
      <td>1</td>
      <td>1536</td>
    </tr>
    <tr>
      <th>2</th>
      <td>92703</td>
      <td>Lybrel</td>
      <td>Birth Control</td>
      <td>&quot;I used to take another oral contraceptive, wh...</td>
      <td>5</td>
      <td>2009-12-14</td>
      <td>17</td>
      <td>2009</td>
      <td>12</td>
      <td>0</td>
      <td>85</td>
    </tr>
    <tr>
      <th>3</th>
      <td>138000</td>
      <td>Ortho Evra</td>
      <td>Birth Control</td>
      <td>&quot;This is my first time using any form of birth...</td>
      <td>8</td>
      <td>2015-11-03</td>
      <td>10</td>
      <td>2015</td>
      <td>11</td>
      <td>1</td>
      <td>80</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35696</td>
      <td>Buprenorphine / naloxone</td>
      <td>Opiate Dependence</td>
      <td>&quot;Suboxone has completely turned my life around...</td>
      <td>9</td>
      <td>2016-11-27</td>
      <td>37</td>
      <td>2016</td>
      <td>11</td>
      <td>1</td>
      <td>333</td>
    </tr>
  </tbody>
</table>
</div>



<pre><code class="lang-python">dill.dump(drug_popularity_dict, <span class="hljs-keyword">open</span>(<span class="hljs-symbol">'data</span>/drug_popularity_dict.pkd',<span class="hljs-symbol">'wb'</span>))
dill.dump(condition_popularity_dict, <span class="hljs-keyword">open</span>(<span class="hljs-symbol">'data</span>/condition_popularity_dict.pkd',<span class="hljs-symbol">'wb'</span>))
</code></pre>
<pre><code class="lang-python">dill.dump(drug_popularity_dict, <span class="hljs-keyword">open</span>(<span class="hljs-symbol">'data</span>/drug_popularity_dict.pkd', <span class="hljs-symbol">'wb'</span>))
dill.dump(condition_popularity_dict, <span class="hljs-keyword">open</span>(
    <span class="hljs-symbol">'data</span>/condition_popularity_dict.pkd', <span class="hljs-symbol">'wb'</span>))
</code></pre>
<h4 id="load-the-dictionaries">load the dictionaries</h4>
<pre><code class="lang-python">df_all[<span class="hljs-string">'condition'</span>].apply(lambda x: str(x).split())
</code></pre>
<pre><code><span class="hljs-number">0</span>         <span class="hljs-string">[Left, Ventricular, Dysfunction]</span>
<span class="hljs-number">1</span>                                   <span class="hljs-string">[ADHD]</span>
<span class="hljs-number">2</span>                         <span class="hljs-string">[Birth, Control]</span>
<span class="hljs-number">3</span>                         <span class="hljs-string">[Birth, Control]</span>
<span class="hljs-number">4</span>                     <span class="hljs-string">[Opiate, Dependence]</span>
                        ...               
<span class="hljs-number">215058</span>       <span class="hljs-string">[Breast, Cancer,, Prevention]</span>
<span class="hljs-number">215059</span>                           <span class="hljs-string">[Anxiety]</span>
<span class="hljs-number">215060</span>                    <span class="hljs-string">[Birth, Control]</span>
<span class="hljs-number">215061</span>                              <span class="hljs-string">[Pain]</span>
<span class="hljs-number">215062</span>                          <span class="hljs-string">[Sciatica]</span>
Name: condition, Length: <span class="hljs-number">215063</span>, dtype: object
</code></pre><pre><code class="lang-python"><span class="hljs-built_in">from</span> bs4 import BeautifulSoup
<span class="hljs-built_in">from</span> nltk.stem.snowball import SnowballStemmer
<span class="hljs-built_in">from</span> nltk.corpus import stopwords
<span class="hljs-built_in">from</span> nltk import PorterStemmer <span class="hljs-keyword">as</span> Porter_stemmer
import re
import nltk
<span class="hljs-built_in">from</span> wordcloud import WordCloud, STOPWORDS
import <span class="hljs-keyword">string</span>
import difflib
import numpy <span class="hljs-keyword">as</span> np
<span class="hljs-built_in">from</span> itertools import <span class="hljs-built_in">compress</span>

drug_popularity_dict = dill.<span class="hljs-built_in">load</span>(<span class="hljs-built_in">open</span>(<span class="hljs-string">'data/drug_popularity_dict.pkd'</span>, <span class="hljs-string">'rb'</span>))
condition_popularity_dict = dill.<span class="hljs-built_in">load</span>(
    <span class="hljs-built_in">open</span>(<span class="hljs-string">'data/condition_popularity_dict.pkd'</span>, <span class="hljs-string">'rb'</span>))


Snowball_stemmer = SnowballStemmer(<span class="hljs-string">'english'</span>)
nltk_stopwords = stopwords.<span class="hljs-keyword">words</span>(<span class="hljs-string">'english'</span>)
stopWords = STOPWORDS.<span class="hljs-built_in">union</span>(nltk_stopwords)


def clean_user_input(user_input, stopWords=stopWords, stemmer=Snowball_stemmer):

    letters_only = re.sub(<span class="hljs-string">'[^a-zA-Z]'</span>, <span class="hljs-string">' '</span>, user_input)
    <span class="hljs-keyword">words</span> = letters_only.<span class="hljs-built_in">lower</span>().<span class="hljs-built_in">split</span>()
    meaningfulWords = [w <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> <span class="hljs-keyword">words</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> w <span class="hljs-keyword">in</span> stopWords]
    stemming_words = [stemmer.stem(w) <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> meaningfulWords]
    <span class="hljs-literal">return</span>(<span class="hljs-string">' '</span>.join(stemming_words))


def get_average_score(actual_condition, condition_dict=condition_popularity_dict):

    vals = condition_dict.<span class="hljs-built_in">get</span>(actual_condition).values()
    len_vals = <span class="hljs-built_in">len</span>(vals<span class="hljs-comment">)//10 + 1</span>
    <span class="hljs-keyword">if</span> len_vals == <span class="hljs-number">1</span>:
        <span class="hljs-literal">return</span> tuple(np.zeros(<span class="hljs-number">5</span>))
    vals = list(sorted(vals, key=lambda x: -
                       (x[<span class="hljs-number">0</span>]+x[<span class="hljs-number">1</span>]/<span class="hljs-number">10.0</span>+np.<span class="hljs-built_in">log10</span>(x[<span class="hljs-number">2</span>]))/<span class="hljs-number">3</span>))[:len_vals]
    mask = ~np.isnan(vals).<span class="hljs-keyword">any</span>(axis=<span class="hljs-number">1</span>)
    values = list(<span class="hljs-built_in">compress</span>(vals[:len_vals], mask))
    <span class="hljs-comment">#print(np.mean(values, axis=0))</span>
    <span class="hljs-literal">return</span> tuple(np.mean(values, axis=<span class="hljs-number">0</span>))


def find_winner_drug(drug_dict, relevance_threshold=<span class="hljs-number">0.6</span>, rating_threshold=<span class="hljs-number">6</span>):

    <span class="hljs-comment"># relevance higher than 0.6</span>
    relevant_drugs = list(<span class="hljs-built_in">filter</span>(lambda x: drug_dict.<span class="hljs-built_in">get</span>(
        x)[<span class="hljs-number">0</span>] &gt; relevance_threshold <span class="hljs-keyword">and</span> drug_dict.<span class="hljs-built_in">get</span>(x)[<span class="hljs-number">1</span>] &gt; rating_threshold, drug_dict.<span class="hljs-built_in">keys</span>()))
    <span class="hljs-literal">return</span> sorted(relevant_drugs, key=lambda x: (drug_dict.<span class="hljs-built_in">get</span>(x)), reverse=True)[<span class="hljs-number">0</span>]


def find_winner_drug_from_condition(test_condition=<span class="hljs-string">'I have a mild headache'</span>, condition_dict=condition_popularity_dict):

    test_condition = test_condition.strip()
    difflib_similarity_score = []
    gensimWV_similarity_score = []
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> condition_dict.<span class="hljs-built_in">keys</span>():
        score = difflib.SequenceMatcher(
            None, test_condition.<span class="hljs-built_in">lower</span>(), key.<span class="hljs-built_in">lower</span>().strip())
        difflib_similarity_score.append(
            [score.ratio()*<span class="hljs-number">100</span>, key, condition_dict.<span class="hljs-built_in">get</span>(key)])
        gensimWV_similarity_score.append([pearsonr(word_model[test_condition.<span class="hljs-built_in">lower</span>()],
                                                   word_model[key.<span class="hljs-built_in">lower</span>().strip()])[<span class="hljs-number">0</span>],
                                          key, condition_dict.<span class="hljs-built_in">get</span>(key)])
    scores = sorted(difflib_similarity_score, key=lambda x: -x[<span class="hljs-number">0</span>])[:<span class="hljs-number">5</span>]

    gensim_score = <span class="hljs-number">0</span>

    <span class="hljs-comment"># print(scores)</span>
    <span class="hljs-keyword">if</span> scores[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] == <span class="hljs-number">100</span>:
        winner_condition = scores[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
        <span class="hljs-comment"># print(winner_condition)</span>
    <span class="hljs-keyword">else</span>:
        top_5_conditions = [y[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> scores]
        <span class="hljs-comment"># print(top_5_conditions)</span>
        winner_condition = sorted(
            top_5_conditions, key=lambda x: get_average_score(x), reverse=True)[<span class="hljs-number">0</span>]
    <span class="hljs-comment"># print(winner_condition)</span>

    <span class="hljs-literal">return</span> find_winner_drug(condition_dict.<span class="hljs-built_in">get</span>(winner_condition))
</code></pre>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-title">list</span><span class="hljs-params">(condition_popularity_dict.items()</span></span>)[:<span class="hljs-number">5</span>]
</code></pre>
<pre><code>[(<span class="hljs-symbol">'Bacterial</span> Skin Infection',
  {<span class="hljs-symbol">'A</span> + D Cracked Skin Relief<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>],
   <span class="hljs-symbol">'Bacitracin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">8</span>],
   <span class="hljs-symbol">'Bacitracin</span> / neomycin / polymyxin b<span class="hljs-symbol">':</span> [<span class="hljs-name">0.6</span>,
    <span class="hljs-number">7.666666666666667</span>,
    <span class="hljs-number">5.081081081081081</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">37</span>],
   <span class="hljs-symbol">'Bacitracin</span> / neomycin / polymyxin b / pramoxine<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],
   <span class="hljs-symbol">'Bacitracin</span> / polymyxin b<span class="hljs-symbol">':</span> [<span class="hljs-name">0.5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">12</span>],
   <span class="hljs-symbol">'Bactrim</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.16483516483516483</span>,
    <span class="hljs-number">6.955555555555556</span>,
    <span class="hljs-number">8.177383592017739</span>,
    <span class="hljs-number">45</span>,
    <span class="hljs-number">2255</span>],
   <span class="hljs-symbol">'Bactrim</span> DS<span class="hljs-symbol">':</span> [<span class="hljs-name">0.14035087719298245</span>,
    <span class="hljs-number">4.791666666666667</span>,
    <span class="hljs-number">5.024253731343284</span>,
    <span class="hljs-number">24</span>,
    <span class="hljs-number">536</span>],
   <span class="hljs-symbol">'Benzalkonium</span> chloride / lidocaine<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>],
   <span class="hljs-symbol">'Co-trimoxazole</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">14</span>],
   <span class="hljs-symbol">'Neosporin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">6.5</span>, <span class="hljs-number">5.081081081081081</span>, <span class="hljs-number">2</span>, <span class="hljs-number">37</span>],
   <span class="hljs-symbol">'Polysporin</span> First Aid Antibiotic Ointment<span class="hljs-symbol">':</span> [<span class="hljs-name">0.5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">12</span>],
   <span class="hljs-symbol">'Septra</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.07692307692307693</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>],
   <span class="hljs-symbol">'Septra</span> DS<span class="hljs-symbol">':</span> [<span class="hljs-name">0.10526315789473684</span>, <span class="hljs-number">5.5</span>, <span class="hljs-number">5.6923076923076925</span>, <span class="hljs-number">2</span>, <span class="hljs-number">13</span>],
   <span class="hljs-symbol">'Sulfamethoxazole</span> / trimethoprim<span class="hljs-symbol">':</span> [<span class="hljs-name">0.15121255349500715</span>,
    <span class="hljs-number">5.839622641509434</span>,
    <span class="hljs-number">7.435831457060148</span>,
    <span class="hljs-number">106</span>,
    <span class="hljs-number">3109</span>],
   <span class="hljs-symbol">'Triple</span> Antibiotic<span class="hljs-symbol">':</span> [<span class="hljs-name">0.5</span>, <span class="hljs-number">10</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]}),
 (<span class="hljs-symbol">'Otitis</span> Media',
  {<span class="hljs-symbol">'A</span> / B Otic<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">38</span>],
   <span class="hljs-symbol">'Amoxicillin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.047619047619047616</span>,
    <span class="hljs-number">5.857142857142857</span>,
    <span class="hljs-number">7.666666666666667</span>,
    <span class="hljs-number">7</span>,
    <span class="hljs-number">57</span>],
   <span class="hljs-symbol">'Amoxicillin</span> / clavulanate<span class="hljs-symbol">':</span> [<span class="hljs-name">0.05489260143198091</span>,
    <span class="hljs-number">4.826086956521739</span>,
    <span class="hljs-number">6.228915662650603</span>,
    <span class="hljs-number">23</span>,
    <span class="hljs-number">166</span>],
   <span class="hljs-symbol">'Antipyrine</span> / benzocaine<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">68</span>],
   <span class="hljs-symbol">'Augmentin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.06607929515418502</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">6.39873417721519</span>, <span class="hljs-number">15</span>, <span class="hljs-number">158</span>],
   <span class="hljs-symbol">'Azithromycin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.016574585635359115</span>,
    <span class="hljs-number">7.166666666666667</span>,
    <span class="hljs-number">8.027322404371585</span>,
    <span class="hljs-number">12</span>,
    <span class="hljs-number">183</span>],
   <span class="hljs-symbol">'Bactrim</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.01098901098901099</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">4.413793103448276</span>, <span class="hljs-number">3</span>, <span class="hljs-number">29</span>],
   <span class="hljs-symbol">'Biaxin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.03076923076923077</span>, <span class="hljs-number">6.5</span>, <span class="hljs-number">5.961538461538462</span>, <span class="hljs-number">2</span>, <span class="hljs-number">26</span>],
   <span class="hljs-symbol">'Cefdinir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.22346368715083798</span>, <span class="hljs-number">4.45</span>, <span class="hljs-number">5.319410319410319</span>, <span class="hljs-number">40</span>, <span class="hljs-number">407</span>],
   <span class="hljs-symbol">'Cefixime</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.1111111111111111</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>],
   <span class="hljs-symbol">'Ceftriaxone</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.04477611940298507</span>,
    <span class="hljs-number">9.666666666666666</span>,
    <span class="hljs-number">9.735294117647058</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">34</span>],
   <span class="hljs-symbol">'Cefuroxime</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.014285714285714285</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>],
   <span class="hljs-symbol">'Cephalexin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.009852216748768473</span>, <span class="hljs-number">8.5</span>, <span class="hljs-number">8.179487179487179</span>, <span class="hljs-number">2</span>, <span class="hljs-number">39</span>],
   <span class="hljs-symbol">'Ciprodex</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.4838709677419355</span>,
    <span class="hljs-number">6.933333333333334</span>,
    <span class="hljs-number">7.090128755364807</span>,
    <span class="hljs-number">15</span>,
    <span class="hljs-number">233</span>],
   <span class="hljs-symbol">'Ciprofloxacin</span> / dexamethasone<span class="hljs-symbol">':</span> [<span class="hljs-name">0.5172413793103449</span>,
    <span class="hljs-number">6.933333333333334</span>,
    <span class="hljs-number">7.090128755364807</span>,
    <span class="hljs-number">15</span>,
    <span class="hljs-number">233</span>],
   <span class="hljs-symbol">'Clarithromycin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.03571428571428571</span>,
    <span class="hljs-number">7.285714285714286</span>,
    <span class="hljs-number">7.643564356435643</span>,
    <span class="hljs-number">14</span>,
    <span class="hljs-number">101</span>],
   <span class="hljs-symbol">'Erythromycin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.037037037037037035</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">19</span>],
   <span class="hljs-symbol">'Hydrocortisone</span> / neomycin / polymyxin b<span class="hljs-symbol">':</span> [<span class="hljs-name">0.38461538461538464</span>,
    <span class="hljs-number">2.6</span>,
    <span class="hljs-number">1.6153846153846154</span>,
    <span class="hljs-number">5</span>,
    <span class="hljs-number">13</span>],
   <span class="hljs-symbol">'Keflex</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.02040816326530612</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">32</span>],
   <span class="hljs-symbol">'Levaquin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.010638297872340425</span>,
    <span class="hljs-number">4.666666666666667</span>,
    <span class="hljs-number">6.808510638297872</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">47</span>],
   <span class="hljs-symbol">'Levofloxacin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.011848341232227487</span>, <span class="hljs-number">3.2</span>, <span class="hljs-number">5.963636363636364</span>, <span class="hljs-number">5</span>, <span class="hljs-number">55</span>],
   <span class="hljs-symbol">'Ofloxacin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.16666666666666666</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Omnicef</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.4</span>, <span class="hljs-number">6.4375</span>, <span class="hljs-number">6.8019323671497585</span>, <span class="hljs-number">16</span>, <span class="hljs-number">207</span>],
   <span class="hljs-symbol">'Rocephin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.04838709677419355</span>,
    <span class="hljs-number">9.666666666666666</span>,
    <span class="hljs-number">9.735294117647058</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">34</span>],
   <span class="hljs-symbol">'Septra</span> DS<span class="hljs-symbol">':</span> [<span class="hljs-name">0.05263157894736842</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>],
   <span class="hljs-symbol">'Sulfamethoxazole</span> / trimethoprim<span class="hljs-symbol">':</span> [<span class="hljs-name">0.008559201141226819</span>,
    <span class="hljs-number">5.166666666666667</span>,
    <span class="hljs-number">4.717948717948718</span>,
    <span class="hljs-number">6</span>,
    <span class="hljs-number">39</span>],
   <span class="hljs-symbol">'Suprax</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.14285714285714285</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>],
   <span class="hljs-symbol">'Zithromax</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.04854368932038835</span>, <span class="hljs-number">6.8</span>, <span class="hljs-number">8.086206896551724</span>, <span class="hljs-number">5</span>, <span class="hljs-number">116</span>]}),
 (<span class="hljs-symbol">'HIV</span> Infection',
  {<span class="hljs-symbol">'Abacavir</span> / dolutegravir / lamivudine<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>,
    <span class="hljs-number">8.414285714285715</span>,
    <span class="hljs-number">8.758046614872365</span>,
    <span class="hljs-number">70</span>,
    <span class="hljs-number">901</span>],
   <span class="hljs-symbol">'Abacavir</span> / lamivudine<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">11</span>],
   <span class="hljs-symbol">'Abacavir</span> / lamivudine / zidovudine<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Atazanavir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>],
   <span class="hljs-symbol">'Atripla</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.967032967032967</span>,
    <span class="hljs-number">9.102272727272727</span>,
    <span class="hljs-number">9.244350282485875</span>,
    <span class="hljs-number">88</span>,
    <span class="hljs-number">1416</span>],
   <span class="hljs-symbol">'Cobicistat</span> / darunavir<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4.6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">15</span>],
   <span class="hljs-symbol">'Cobicistat</span> / elvitegravir / emtricitabine / tenofovir<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>,
    <span class="hljs-number">9.460526315789474</span>,
    <span class="hljs-number">9.664291369754553</span>,
    <span class="hljs-number">76</span>,
    <span class="hljs-number">1263</span>],
   <span class="hljs-symbol">'Cobicistat</span> / elvitegravir / emtricitabine / tenofovir alafenamide<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>,
    <span class="hljs-number">7.963636363636364</span>,
    <span class="hljs-number">7.466666666666667</span>,
    <span class="hljs-number">55</span>,
    <span class="hljs-number">525</span>],
   <span class="hljs-symbol">'Combivir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.6666666666666666</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>],
   <span class="hljs-symbol">'Complera</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.98</span>, <span class="hljs-number">8.26530612244898</span>, <span class="hljs-number">8.78497790868925</span>, <span class="hljs-number">49</span>, <span class="hljs-number">679</span>],
   <span class="hljs-symbol">'Darunavir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">7.75</span>, <span class="hljs-number">8.892857142857142</span>, <span class="hljs-number">4</span>, <span class="hljs-number">28</span>],
   <span class="hljs-symbol">'Dolutegravir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8.292682926829269</span>, <span class="hljs-number">13</span>, <span class="hljs-number">41</span>],
   <span class="hljs-symbol">'Efavirenz</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.8571428571428571</span>, <span class="hljs-number">5.666666666666667</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>],
   <span class="hljs-symbol">'Efavirenz</span> / emtricitabine / tenofovir<span class="hljs-symbol">':</span> [<span class="hljs-name">0.978494623655914</span>,
    <span class="hljs-number">9.12087912087912</span>,
    <span class="hljs-number">9.246478873239436</span>,
    <span class="hljs-number">91</span>,
    <span class="hljs-number">1420</span>],
   <span class="hljs-symbol">'Emtricitabine</span> / rilpivirine / tenofovir<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>,
    <span class="hljs-number">8.26530612244898</span>,
    <span class="hljs-number">8.78497790868925</span>,
    <span class="hljs-number">49</span>,
    <span class="hljs-number">679</span>],
   <span class="hljs-symbol">'Emtricitabine</span> / rilpivirine / tenofovir alafenamide<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>,
    <span class="hljs-number">10</span>,
    <span class="hljs-number">10.0</span>,
    <span class="hljs-number">2</span>,
    <span class="hljs-number">47</span>],
   <span class="hljs-symbol">'Emtricitabine</span> / tenofovir<span class="hljs-symbol">':</span> [<span class="hljs-name">0.7142857142857143</span>,
    <span class="hljs-number">9.1</span>,
    <span class="hljs-number">9.479591836734693</span>,
    <span class="hljs-number">10</span>,
    <span class="hljs-number">98</span>],
   <span class="hljs-symbol">'Enfuvirtide</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>],
   <span class="hljs-symbol">'Epivir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>],
   <span class="hljs-symbol">'Epzicom</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">11</span>],
   <span class="hljs-symbol">'Etravirine</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
   <span class="hljs-symbol">'Fuzeon</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>],
   <span class="hljs-symbol">'Genvoya</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">7.963636363636364</span>, <span class="hljs-number">7.466666666666667</span>, <span class="hljs-number">55</span>, <span class="hljs-number">525</span>],
   <span class="hljs-symbol">'Intelence</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
   <span class="hljs-symbol">'Isentress</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.833333333333334</span>, <span class="hljs-number">8.951612903225806</span>, <span class="hljs-number">12</span>, <span class="hljs-number">62</span>],
   <span class="hljs-symbol">'Kaletra</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8.727272727272727</span>, <span class="hljs-number">2</span>, <span class="hljs-number">11</span>],
   <span class="hljs-symbol">'Lamivudine</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.6666666666666666</span>, <span class="hljs-number">8.5</span>, <span class="hljs-number">8.5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>],
   <span class="hljs-symbol">'Lamivudine</span> / zidovudine<span class="hljs-symbol">':</span> [<span class="hljs-name">0.6666666666666666</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>],
   <span class="hljs-symbol">'Lopinavir</span> / ritonavir<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.666666666666666</span>, <span class="hljs-number">8.727272727272727</span>, <span class="hljs-number">3</span>, <span class="hljs-number">11</span>],
   <span class="hljs-symbol">'Maraviroc</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>],
   <span class="hljs-symbol">'Nevirapine</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8.4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>],
   <span class="hljs-symbol">'Norvir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">1</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],
   <span class="hljs-symbol">'Odefsey</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">47</span>],
   <span class="hljs-symbol">'Prezcobix</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4.6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">15</span>],
   <span class="hljs-symbol">'Prezista</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">7.666666666666667</span>, <span class="hljs-number">9.08695652173913</span>, <span class="hljs-number">3</span>, <span class="hljs-number">23</span>],
   <span class="hljs-symbol">'Raltegravir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.615384615384615</span>, <span class="hljs-number">8.951612903225806</span>, <span class="hljs-number">13</span>, <span class="hljs-number">62</span>],
   <span class="hljs-symbol">'Reyataz</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>],
   <span class="hljs-symbol">'Ritonavir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">1</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],
   <span class="hljs-symbol">'Selzentry</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>],
   <span class="hljs-symbol">'Stribild</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.987012987012987</span>,
    <span class="hljs-number">9.460526315789474</span>,
    <span class="hljs-number">9.664291369754553</span>,
    <span class="hljs-number">76</span>,
    <span class="hljs-number">1263</span>],
   <span class="hljs-symbol">'Sustiva</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.8</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3.6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>],
   <span class="hljs-symbol">'Tivicay</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.272727272727273</span>, <span class="hljs-number">8.275</span>, <span class="hljs-number">11</span>, <span class="hljs-number">40</span>],
   <span class="hljs-symbol">'Triumeq</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.46376811594203</span>, <span class="hljs-number">8.762222222222222</span>, <span class="hljs-number">69</span>, <span class="hljs-number">900</span>],
   <span class="hljs-symbol">'Trizivir</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Truvada</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.7692307692307693</span>, <span class="hljs-number">9.1</span>, <span class="hljs-number">9.479591836734693</span>, <span class="hljs-number">10</span>, <span class="hljs-number">98</span>],
   <span class="hljs-symbol">'Viramune</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">4.5</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]}),
 (<span class="hljs-symbol">'Juvenile</span> Idiopathic Arthritis',
  {<span class="hljs-symbol">'Abatacept</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.08</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18</span>],
   <span class="hljs-symbol">'Actemra</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.23529411764705882</span>, <span class="hljs-number">7.75</span>, <span class="hljs-number">8.50909090909091</span>, <span class="hljs-number">4</span>, <span class="hljs-number">55</span>],
   <span class="hljs-symbol">'Adalimumab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.005235602094240838</span>, <span class="hljs-number">9.5</span>, <span class="hljs-number">9.208333333333334</span>, <span class="hljs-number">2</span>, <span class="hljs-number">24</span>],
   <span class="hljs-symbol">'Enbrel</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.015625</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">8.88888888888889</span>, <span class="hljs-number">3</span>, <span class="hljs-number">27</span>],
   <span class="hljs-symbol">'Etanercept</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.014778325123152709</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">8.88888888888889</span>, <span class="hljs-number">3</span>, <span class="hljs-number">27</span>],
   <span class="hljs-symbol">'Humira</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.005319148936170213</span>, <span class="hljs-number">9.5</span>, <span class="hljs-number">9.208333333333334</span>, <span class="hljs-number">2</span>, <span class="hljs-number">24</span>],
   <span class="hljs-symbol">'Infliximab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.007194244604316547</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Orencia</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.08333333333333333</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18</span>],
   <span class="hljs-symbol">'Remicade</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.007692307692307693</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Tocilizumab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.2222222222222222</span>, <span class="hljs-number">7.75</span>, <span class="hljs-number">8.50909090909091</span>, <span class="hljs-number">4</span>, <span class="hljs-number">55</span>]}),
 (<span class="hljs-symbol">'Rheumatoid</span> Arthritis',
  {<span class="hljs-symbol">'Abatacept</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.92</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7.983230361871138</span>, <span class="hljs-number">23</span>, <span class="hljs-number">1133</span>],
   <span class="hljs-symbol">'Absorbine</span> Jr.<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Acetaminophen</span> / hydrocodone<span class="hljs-symbol">':</span> [<span class="hljs-name">0.03367496339677892</span>,
    <span class="hljs-number">7.565217391304348</span>,
    <span class="hljs-number">8.98984375</span>,
    <span class="hljs-number">23</span>,
    <span class="hljs-number">1280</span>],
   <span class="hljs-symbol">'Acetaminophen</span> / tramadol<span class="hljs-symbol">':</span> [<span class="hljs-name">0.06818181818181818</span>,
    <span class="hljs-number">8.666666666666666</span>,
    <span class="hljs-number">8.929577464788732</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">71</span>],
   <span class="hljs-symbol">'Actemra</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.7647058823529411</span>, <span class="hljs-number">8.307692307692308</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">13</span>, <span class="hljs-number">547</span>],
   <span class="hljs-symbol">'Acthar</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.16666666666666666</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>],
   <span class="hljs-symbol">'Adalimumab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.24083769633507854</span>,
    <span class="hljs-number">6.543478260869565</span>,
    <span class="hljs-number">7.552898714189037</span>,
    <span class="hljs-number">92</span>,
    <span class="hljs-number">4433</span>],
   <span class="hljs-symbol">'Advil</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.045454545454545456</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">14</span>],
   <span class="hljs-symbol">'Advil</span> Liqui-Gels<span class="hljs-symbol">':</span> [<span class="hljs-name">0.1</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">45</span>],
   <span class="hljs-symbol">'Aleve</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.06976744186046512</span>,
    <span class="hljs-number">6.833333333333333</span>,
    <span class="hljs-number">7.182080924855492</span>,
    <span class="hljs-number">6</span>,
    <span class="hljs-number">346</span>],
   <span class="hljs-symbol">'Anakinra</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.14285714285714285</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>],
   <span class="hljs-symbol">'Ansaid</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.3333333333333333</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>],
   <span class="hljs-symbol">'Arava</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">6.5</span>, <span class="hljs-number">7.2167761495704905</span>, <span class="hljs-number">20</span>, <span class="hljs-number">1979</span>],
   <span class="hljs-symbol">'Aristospan</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Arthrotec</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.20588235294117646</span>,
    <span class="hljs-number">7.428571428571429</span>,
    <span class="hljs-number">8.789256198347108</span>,
    <span class="hljs-number">7</span>,
    <span class="hljs-number">242</span>],
   <span class="hljs-symbol">'Aspirin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.07692307692307693</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">22</span>],
   <span class="hljs-symbol">'Auranofin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">25</span>],
   <span class="hljs-symbol">'Azathioprine</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.06153846153846154</span>, <span class="hljs-number">3.25</span>, <span class="hljs-number">4.890909090909091</span>, <span class="hljs-number">4</span>, <span class="hljs-number">55</span>],
   <span class="hljs-symbol">'Bextra</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.125</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">8</span>],
   <span class="hljs-symbol">'Celebrex</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.12781954887218044</span>,
    <span class="hljs-number">8.470588235294118</span>,
    <span class="hljs-number">8.801052631578948</span>,
    <span class="hljs-number">17</span>,
    <span class="hljs-number">950</span>],
   <span class="hljs-symbol">'Celecoxib</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.1342281879194631</span>, <span class="hljs-number">8.15</span>, <span class="hljs-number">8.777893639207507</span>, <span class="hljs-number">20</span>, <span class="hljs-number">959</span>],
   <span class="hljs-symbol">'CellCept</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.038461538461538464</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">55</span>],
   <span class="hljs-symbol">'Certolizumab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.18181818181818182</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">7.934343434343434</span>, <span class="hljs-number">4</span>, <span class="hljs-number">198</span>],
   <span class="hljs-symbol">'Cimzia</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.18181818181818182</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">7.934343434343434</span>, <span class="hljs-number">4</span>, <span class="hljs-number">198</span>],
   <span class="hljs-symbol">'Clinoril</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.25</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">20</span>],
   <span class="hljs-symbol">'Corticotropin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.07692307692307693</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>],
   <span class="hljs-symbol">'Daypro</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.75</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6.509803921568627</span>, <span class="hljs-number">3</span>, <span class="hljs-number">51</span>],
   <span class="hljs-symbol">'Deltasone</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.14285714285714285</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">81</span>],
   <span class="hljs-symbol">'Depo-Medrol</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.1</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">16</span>],
   <span class="hljs-symbol">'Diclofenac</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.048701298701298704</span>,
    <span class="hljs-number">7.166666666666667</span>,
    <span class="hljs-number">8.018456375838927</span>,
    <span class="hljs-number">30</span>,
    <span class="hljs-number">596</span>],
   <span class="hljs-symbol">'Diclofenac</span> / misoprostol<span class="hljs-symbol">':</span> [<span class="hljs-name">0.175</span>,
    <span class="hljs-number">7.428571428571429</span>,
    <span class="hljs-number">8.789256198347108</span>,
    <span class="hljs-number">7</span>,
    <span class="hljs-number">242</span>],
   <span class="hljs-symbol">'Diflunisal</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.3333333333333333</span>, <span class="hljs-number">6.5</span>, <span class="hljs-number">5.705882352941177</span>, <span class="hljs-number">2</span>, <span class="hljs-number">17</span>],
   <span class="hljs-symbol">'Dolobid</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.3333333333333333</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>],
   <span class="hljs-symbol">'Doxycycline</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.0023752969121140144</span>, <span class="hljs-number">5.5</span>, <span class="hljs-number">7.2105263157894735</span>, <span class="hljs-number">2</span>, <span class="hljs-number">19</span>],
   <span class="hljs-symbol">'Duexis</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.07142857142857142</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>],
   <span class="hljs-symbol">'Enbrel</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.40625</span>, <span class="hljs-number">8.243589743589743</span>, <span class="hljs-number">8.697256097560976</span>, <span class="hljs-number">78</span>, <span class="hljs-number">3280</span>],
   <span class="hljs-symbol">'Esomeprazole</span> / naproxen<span class="hljs-symbol">':</span> [<span class="hljs-name">0.2727272727272727</span>,
    <span class="hljs-number">8.833333333333334</span>,
    <span class="hljs-number">9.166666666666666</span>,
    <span class="hljs-number">6</span>,
    <span class="hljs-number">114</span>],
   <span class="hljs-symbol">'Etanercept</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.4039408866995074</span>,
    <span class="hljs-number">8.304878048780488</span>,
    <span class="hljs-number">8.701610452749923</span>,
    <span class="hljs-number">82</span>,
    <span class="hljs-number">3291</span>],
   <span class="hljs-symbol">'Etodolac</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.03571428571428571</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">7.2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10</span>],
   <span class="hljs-symbol">'Famotidine</span> / ibuprofen<span class="hljs-symbol">':</span> [<span class="hljs-name">0.07142857142857142</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>],
   <span class="hljs-symbol">'Feldene</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.36363636363636365</span>, <span class="hljs-number">7.5</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">45</span>],
   <span class="hljs-symbol">'Fenoprofen</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.5</span>, <span class="hljs-number">9</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],
   <span class="hljs-symbol">'Flurbiprofen</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.14285714285714285</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>],
   <span class="hljs-symbol">'Gold</span> sodium thiomalate<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Golimumab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.5522388059701493</span>,
    <span class="hljs-number">7.27027027027027</span>,
    <span class="hljs-number">7.809611829944547</span>,
    <span class="hljs-number">37</span>,
    <span class="hljs-number">1082</span>],
   <span class="hljs-symbol">'Humira</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.23670212765957446</span>,
    <span class="hljs-number">6.46067415730337</span>,
    <span class="hljs-number">7.551365996839015</span>,
    <span class="hljs-number">89</span>,
    <span class="hljs-number">4429</span>],
   <span class="hljs-symbol">'Hydroxychloroquine</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.4230769230769231</span>,
    <span class="hljs-number">6.757575757575758</span>,
    <span class="hljs-number">7.2439024390243905</span>,
    <span class="hljs-number">66</span>,
    <span class="hljs-number">4387</span>],
   <span class="hljs-symbol">'IBU</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],
   <span class="hljs-symbol">'Ibuprofen</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.038834951456310676</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">71</span>],
   <span class="hljs-symbol">'Imuran</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.043478260869565216</span>, <span class="hljs-number">4.5</span>, <span class="hljs-number">5.666666666666667</span>, <span class="hljs-number">2</span>, <span class="hljs-number">42</span>],
   <span class="hljs-symbol">'Indocin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.041666666666666664</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">47</span>],
   <span class="hljs-symbol">'Indomethacin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.021739130434782608</span>,
    <span class="hljs-number">8.333333333333334</span>,
    <span class="hljs-number">8.220588235294118</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">68</span>],
   <span class="hljs-symbol">'Infliximab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.19424460431654678</span>,
    <span class="hljs-number">8.185185185185185</span>,
    <span class="hljs-number">8.854289071680377</span>,
    <span class="hljs-number">27</span>,
    <span class="hljs-number">851</span>],
   <span class="hljs-symbol">'Kenalog-40</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.2222222222222222</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">71</span>],
   <span class="hljs-symbol">'Ketoprofen</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.09523809523809523</span>, <span class="hljs-number">8.5</span>, <span class="hljs-number">8.4375</span>, <span class="hljs-number">2</span>, <span class="hljs-number">16</span>],
   <span class="hljs-symbol">'Leflunomide</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.926829268292683</span>,
    <span class="hljs-number">6.526315789473684</span>,
    <span class="hljs-number">7.3215561730845575</span>,
    <span class="hljs-number">38</span>,
    <span class="hljs-number">2519</span>],
   <span class="hljs-symbol">'Lorcet</span> <span class="hljs-number">10</span> / <span class="hljs-number">650</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.07692307692307693</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">49</span>],
   <span class="hljs-symbol">'Lortab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.03816793893129771</span>, <span class="hljs-number">8.8</span>, <span class="hljs-number">9.079681274900398</span>, <span class="hljs-number">5</span>, <span class="hljs-number">251</span>],
   <span class="hljs-symbol">'Medrol</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">44</span>],
   <span class="hljs-symbol">'Medrol</span> Dosepak<span class="hljs-symbol">':</span> [<span class="hljs-name">0.07692307692307693</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">78</span>],
   <span class="hljs-symbol">'Meloxicam</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.1069182389937107</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">7.540876389797253</span>, <span class="hljs-number">34</span>, <span class="hljs-number">1529</span>],
   <span class="hljs-symbol">'Methotrexate</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.4382716049382716</span>,
    <span class="hljs-number">7.211267605633803</span>,
    <span class="hljs-number">8.088976945244957</span>,
    <span class="hljs-number">71</span>,
    <span class="hljs-number">5552</span>],
   <span class="hljs-symbol">'Methyl</span> salicylate<span class="hljs-symbol">':</span> [<span class="hljs-name">0.05263157894736842</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],
   <span class="hljs-symbol">'Methylprednisolone</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.05970149253731343</span>,
    <span class="hljs-number">8.333333333333334</span>,
    <span class="hljs-number">8.547904191616766</span>,
    <span class="hljs-number">12</span>,
    <span class="hljs-number">334</span>],
   <span class="hljs-symbol">'Minocycline</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.005405405405405406</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
   <span class="hljs-symbol">'Mobic</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.1651376146788991</span>, <span class="hljs-number">6.388888888888889</span>, <span class="hljs-number">7.7029053420806</span>, <span class="hljs-number">18</span>, <span class="hljs-number">1067</span>],
   <span class="hljs-symbol">'Motrin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.08333333333333333</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">12</span>],
   <span class="hljs-symbol">'Mycophenolate</span> mofetil<span class="hljs-symbol">':</span> [<span class="hljs-name">0.04878048780487805</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">55</span>],
   <span class="hljs-symbol">'Nabumetone</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.15384615384615385</span>, <span class="hljs-number">4.5</span>, <span class="hljs-number">6.451776649746193</span>, <span class="hljs-number">8</span>, <span class="hljs-number">197</span>],
   <span class="hljs-symbol">'Naprosyn</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.07407407407407407</span>, <span class="hljs-number">6.5</span>, <span class="hljs-number">5.531645569620253</span>, <span class="hljs-number">2</span>, <span class="hljs-number">79</span>],
   <span class="hljs-symbol">'Naproxen</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.047619047619047616</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">7.146551724137931</span>, <span class="hljs-number">19</span>, <span class="hljs-number">696</span>],
   <span class="hljs-symbol">'Norco</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.009708737864077669</span>, <span class="hljs-number">5.5</span>, <span class="hljs-number">8.2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">135</span>],
   <span class="hljs-symbol">'Orencia</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.9166666666666666</span>,
    <span class="hljs-number">6.909090909090909</span>,
    <span class="hljs-number">7.983230361871138</span>,
    <span class="hljs-number">22</span>,
    <span class="hljs-number">1133</span>],
   <span class="hljs-symbol">'Orudis</span> KT<span class="hljs-symbol">':</span> [<span class="hljs-name">0.25</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>],
   <span class="hljs-symbol">'Otrexup</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">30</span>],
   <span class="hljs-symbol">'Oxaprozin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.5714285714285714</span>, <span class="hljs-number">5.5</span>, <span class="hljs-number">6.553571428571429</span>, <span class="hljs-number">4</span>, <span class="hljs-number">56</span>],
   <span class="hljs-symbol">'Piroxicam</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.25</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.548387096774194</span>, <span class="hljs-number">5</span>, <span class="hljs-number">62</span>],
   <span class="hljs-symbol">'Plaquenil</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.40476190476190477</span>,
    <span class="hljs-number">6.647058823529412</span>,
    <span class="hljs-number">6.950321987120515</span>,
    <span class="hljs-number">34</span>,
    <span class="hljs-number">3261</span>],
   <span class="hljs-symbol">'Prednicot</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">25</span>],
   <span class="hljs-symbol">'Prednisone</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.0792838874680307</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.580835603996366</span>, <span class="hljs-number">31</span>, <span class="hljs-number">2202</span>],
   <span class="hljs-symbol">'Relafen</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.11538461538461539</span>, <span class="hljs-number">6.666666666666667</span>, <span class="hljs-number">7.296</span>, <span class="hljs-number">3</span>, <span class="hljs-number">125</span>],
   <span class="hljs-symbol">'Remicade</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.2</span>, <span class="hljs-number">8.115384615384615</span>, <span class="hljs-number">8.850235849056604</span>, <span class="hljs-number">26</span>, <span class="hljs-number">848</span>],
   <span class="hljs-symbol">'Rheumatrex</span> Dose Pack<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">113</span>],
   <span class="hljs-symbol">'Ridaura</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">25</span>],
   <span class="hljs-symbol">'Rituxan</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.42857142857142855</span>,
    <span class="hljs-number">6.777777777777778</span>,
    <span class="hljs-number">7.4072524407252445</span>,
    <span class="hljs-number">9</span>,
    <span class="hljs-number">717</span>],
   <span class="hljs-symbol">'Rituximab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.6266666666666667</span>,
    <span class="hljs-number">7.659574468085107</span>,
    <span class="hljs-number">7.988235294117647</span>,
    <span class="hljs-number">47</span>,
    <span class="hljs-number">2040</span>],
   <span class="hljs-symbol">'Salsalate</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.3333333333333333</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>],
   <span class="hljs-symbol">'Simponi</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.5</span>, <span class="hljs-number">7.551724137931035</span>, <span class="hljs-number">7.830875122910522</span>, <span class="hljs-number">29</span>, <span class="hljs-number">1017</span>],
   <span class="hljs-symbol">'Simponi</span> Aria<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7.5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">56</span>],
   <span class="hljs-symbol">'Sulfasalazine</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.423728813559322</span>, <span class="hljs-number">5.52</span>, <span class="hljs-number">6.836615609044493</span>, <span class="hljs-number">25</span>, <span class="hljs-number">1371</span>],
   <span class="hljs-symbol">'Sulfazine</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.4</span>, <span class="hljs-number">4.75</span>, <span class="hljs-number">5.983050847457627</span>, <span class="hljs-number">4</span>, <span class="hljs-number">354</span>],
   <span class="hljs-symbol">'Sulindac</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.16666666666666666</span>,
    <span class="hljs-number">5.666666666666667</span>,
    <span class="hljs-number">7.1063829787234045</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">47</span>],
   <span class="hljs-symbol">'Tocilizumab</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.7777777777777778</span>,
    <span class="hljs-number">8.214285714285714</span>,
    <span class="hljs-number">8.996350364963504</span>,
    <span class="hljs-number">14</span>,
    <span class="hljs-number">548</span>],
   <span class="hljs-symbol">'Tofacitinib</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">6.135135135135135</span>, <span class="hljs-number">7.074105621805792</span>, <span class="hljs-number">37</span>, <span class="hljs-number">1174</span>],
   <span class="hljs-symbol">'Tolectin</span> DS<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">9</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],
   <span class="hljs-symbol">'Tolmetin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.5</span>, <span class="hljs-number">9</span>, nan, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],
   <span class="hljs-symbol">'Tramadol</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.007950530035335688</span>,
    <span class="hljs-number">9.444444444444445</span>,
    <span class="hljs-number">9.239473684210527</span>,
    <span class="hljs-number">9</span>,
    <span class="hljs-number">380</span>],
   <span class="hljs-symbol">'Triamcinolone</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.03597122302158273</span>, <span class="hljs-number">9.8</span>, <span class="hljs-number">9.98611111111111</span>, <span class="hljs-number">5</span>, <span class="hljs-number">72</span>],
   <span class="hljs-symbol">'Trolamine</span> salicylate<span class="hljs-symbol">':</span> [<span class="hljs-name">0.041666666666666664</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>],
   <span class="hljs-symbol">'Ultracet</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.041666666666666664</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">66</span>],
   <span class="hljs-symbol">'Ultram</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.005025125628140704</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">96</span>],
   <span class="hljs-symbol">'Valdecoxib</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.1111111111111111</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">8</span>],
   <span class="hljs-symbol">'Vicodin</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.05</span>, <span class="hljs-number">9.833333333333334</span>, <span class="hljs-number">9.762162162162163</span>, <span class="hljs-number">6</span>, <span class="hljs-number">555</span>],
   <span class="hljs-symbol">'Vimovo</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.2727272727272727</span>,
    <span class="hljs-number">8.833333333333334</span>,
    <span class="hljs-number">9.166666666666666</span>,
    <span class="hljs-number">6</span>,
    <span class="hljs-number">114</span>],
   <span class="hljs-symbol">'Voltaren</span><span class="hljs-symbol">':</span> [<span class="hljs-name">0.09734513274336283</span>,
    <span class="hljs-number">6.454545454545454</span>,
    <span class="hljs-number">8.312292358803987</span>,
    <span class="hljs-number">11</span>,
    <span class="hljs-number">301</span>],
   <span class="hljs-symbol">'Xeljanz</span><span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">5.878787878787879</span>, <span class="hljs-number">7.067463706233988</span>, <span class="hljs-number">33</span>, <span class="hljs-number">1171</span>],
   <span class="hljs-symbol">'Xeljanz</span> XR<span class="hljs-symbol">':</span> [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.25</span>, <span class="hljs-number">9.666666666666666</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]})]
</code></pre><pre><code class="lang-python"><span class="hljs-selector-tag">df_all</span><span class="hljs-selector-class">.shape</span>
</code></pre>
<pre><code>(<span class="hljs-number">215063</span>, <span class="hljs-number">11</span>)
</code></pre><pre><code class="lang-python"><span class="hljs-selector-tag">df_all</span><span class="hljs-selector-class">.head</span>()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uniqueID</th>
      <th>drugName</th>
      <th>condition</th>
      <th>review</th>
      <th>rating</th>
      <th>date</th>
      <th>usefulCount</th>
      <th>year</th>
      <th>month</th>
      <th>sentiment</th>
      <th>weighted_by_count_rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>206461</td>
      <td>Valsartan</td>
      <td>Left Ventricular Dysfunction</td>
      <td>&quot;It has no side effect, I take it in combinati...</td>
      <td>9</td>
      <td>2012-05-20</td>
      <td>27</td>
      <td>2012</td>
      <td>5</td>
      <td>1</td>
      <td>243</td>
    </tr>
    <tr>
      <th>1</th>
      <td>95260</td>
      <td>Guanfacine</td>
      <td>ADHD</td>
      <td>&quot;My son is halfway through his fourth week of ...</td>
      <td>8</td>
      <td>2010-04-27</td>
      <td>192</td>
      <td>2010</td>
      <td>4</td>
      <td>1</td>
      <td>1536</td>
    </tr>
    <tr>
      <th>2</th>
      <td>92703</td>
      <td>Lybrel</td>
      <td>Birth Control</td>
      <td>&quot;I used to take another oral contraceptive, wh...</td>
      <td>5</td>
      <td>2009-12-14</td>
      <td>17</td>
      <td>2009</td>
      <td>12</td>
      <td>0</td>
      <td>85</td>
    </tr>
    <tr>
      <th>3</th>
      <td>138000</td>
      <td>Ortho Evra</td>
      <td>Birth Control</td>
      <td>&quot;This is my first time using any form of birth...</td>
      <td>8</td>
      <td>2015-11-03</td>
      <td>10</td>
      <td>2015</td>
      <td>11</td>
      <td>1</td>
      <td>80</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35696</td>
      <td>Buprenorphine / naloxone</td>
      <td>Opiate Dependence</td>
      <td>&quot;Suboxone has completely turned my life around...</td>
      <td>9</td>
      <td>2016-11-27</td>
      <td>37</td>
      <td>2016</td>
      <td>11</td>
      <td>1</td>
      <td>333</td>
    </tr>
  </tbody>
</table>
</div>




<pre><code class="lang-python"><span class="hljs-attr">headers</span> = [<span class="hljs-string">"drugName"</span>,<span class="hljs-string">"condition"</span>,<span class="hljs-string">"rating"</span>,<span class="hljs-string">"usefulCount"</span>,<span class="hljs-string">"year"</span>,<span class="hljs-string">"month"</span>,<span class="hljs-string">"sentiment"</span>,<span class="hljs-string">"weighted_by_count_rating"</span>]
df_all.to_csv('drugs.csv', <span class="hljs-attr">columns</span> = headers, <span class="hljs-attr">header=True,</span> <span class="hljs-attr">index=True)</span>
</code></pre>
<pre><code class="lang-python"><span class="hljs-selector-tag">difflib</span><span class="hljs-selector-class">.SequenceMatcher</span>(None, <span class="hljs-string">'Back Pain'</span>, <span class="hljs-string">'Back Pain'</span>)<span class="hljs-selector-class">.ratio</span>()
</code></pre>
<pre><code>0<span class="hljs-selector-class">.7777777777777778</span>
</code></pre><pre><code class="lang-python">import spacy
nlp = spacy.<span class="hljs-built_in">load</span>(<span class="hljs-string">'en_core_web_sm'</span>, disable=[<span class="hljs-string">'ner'</span>, <span class="hljs-string">'parser'</span>])


def clean_name(doc):
    txt = [<span class="hljs-keyword">token</span>.lemma_ <span class="hljs-keyword">for</span> <span class="hljs-keyword">token</span> <span class="hljs-keyword">in</span> doc <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">token</span>.is_stop]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(txt) &gt; <span class="hljs-number">2</span>:
        <span class="hljs-literal">return</span> <span class="hljs-string">' '</span>.join(txt)
</code></pre>
<pre><code class="lang-python">brief_cleaning = (<span class="hljs-name">re</span>.sub(<span class="hljs-string">"[^A-Za-z']+"</span>, ' ', str(<span class="hljs-name">row</span>)).lower() for row in df_all['condition'])
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">([<span class="hljs-number">1.66666667</span>, <span class="hljs-number">0.33333333</span>])</span></span>
</code></pre><pre><code class="lang-python"><span class="hljs-number">5</span><span class="hljs-comment">//2+1</span>
</code></pre>
<pre><code><span class="hljs-number">3</span>
</code></pre><pre><code class="lang-python">
</code></pre>
<pre><code>[<span class="hljs-symbol">'Diarrhea</span>', <span class="hljs-symbol">'Diarrhea</span>, Acute', <span class="hljs-symbol">'Rhinorrhea</span>']
[[<span class="hljs-name">0.09523809523809523</span>, <span class="hljs-number">9.557377049180328</span>, <span class="hljs-number">61</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">33</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.04739336492891</span>, <span class="hljs-number">1477</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">8</span>], [<span class="hljs-name">0.5833333333333334</span>, <span class="hljs-number">9.444444444444445</span>, <span class="hljs-number">72</span>], [<span class="hljs-name">0.1111111111111111</span>, <span class="hljs-number">9.79245283018868</span>, <span class="hljs-number">53</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.03347280334728</span>, <span class="hljs-number">239</span>], [<span class="hljs-name">0.35714285714285715</span>, <span class="hljs-number">8.731182795698924</span>, <span class="hljs-number">93</span>], [<span class="hljs-name">0.5454545454545454</span>, <span class="hljs-number">9.194029850746269</span>, <span class="hljs-number">134</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">7</span>], [<span class="hljs-name">0.04</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">8</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.990291262135923</span>, <span class="hljs-number">1339</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">68</span>], [<span class="hljs-name">0.5609756097560976</span>, <span class="hljs-number">9.345088161209068</span>, <span class="hljs-number">397</span>], [<span class="hljs-name">0.10526315789473684</span>, <span class="hljs-number">9.557377049180328</span>, <span class="hljs-number">61</span>], [<span class="hljs-name">0.25</span>, <span class="hljs-number">6.875</span>, <span class="hljs-number">24</span>], [<span class="hljs-name">0.9411764705882353</span>, <span class="hljs-number">9.386206896551725</span>, <span class="hljs-number">290</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.444444444444445</span>, <span class="hljs-number">9</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.68421052631579</span>, <span class="hljs-number">190</span>], [<span class="hljs-name">0.5454545454545454</span>, <span class="hljs-number">9.393939393939394</span>, <span class="hljs-number">66</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>], [<span class="hljs-name">0.06666666666666667</span>, <span class="hljs-number">9.395604395604396</span>, <span class="hljs-number">182</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.975609756097562</span>, <span class="hljs-number">246</span>], [<span class="hljs-name">0.2857142857142857</span>, <span class="hljs-number">6.875</span>, <span class="hljs-number">24</span>], [<span class="hljs-name">0.09523809523809523</span>, <span class="hljs-number">9.395604395604396</span>, <span class="hljs-number">182</span>]]
[[<span class="hljs-name">0.09523809523809523</span>, <span class="hljs-number">9.557377049180328</span>, <span class="hljs-number">61</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">33</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.04739336492891</span>, <span class="hljs-number">1477</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">8</span>], [<span class="hljs-name">0.5833333333333334</span>, <span class="hljs-number">9.444444444444445</span>, <span class="hljs-number">72</span>], [<span class="hljs-name">0.1111111111111111</span>, <span class="hljs-number">9.79245283018868</span>, <span class="hljs-number">53</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.03347280334728</span>, <span class="hljs-number">239</span>], [<span class="hljs-name">0.35714285714285715</span>, <span class="hljs-number">8.731182795698924</span>, <span class="hljs-number">93</span>], [<span class="hljs-name">0.5454545454545454</span>, <span class="hljs-number">9.194029850746269</span>, <span class="hljs-number">134</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">7</span>], [<span class="hljs-name">0.04</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">8</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.990291262135923</span>, <span class="hljs-number">1339</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">68</span>], [<span class="hljs-name">0.5609756097560976</span>, <span class="hljs-number">9.345088161209068</span>, <span class="hljs-number">397</span>], [<span class="hljs-name">0.10526315789473684</span>, <span class="hljs-number">9.557377049180328</span>, <span class="hljs-number">61</span>], [<span class="hljs-name">0.25</span>, <span class="hljs-number">6.875</span>, <span class="hljs-number">24</span>], [<span class="hljs-name">0.9411764705882353</span>, <span class="hljs-number">9.386206896551725</span>, <span class="hljs-number">290</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.444444444444445</span>, <span class="hljs-number">9</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.68421052631579</span>, <span class="hljs-number">190</span>], [<span class="hljs-name">0.5454545454545454</span>, <span class="hljs-number">9.393939393939394</span>, <span class="hljs-number">66</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">1</span>], [<span class="hljs-name">0.06666666666666667</span>, <span class="hljs-number">9.395604395604396</span>, <span class="hljs-number">182</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">8.975609756097562</span>, <span class="hljs-number">246</span>], [<span class="hljs-name">0.2857142857142857</span>, <span class="hljs-number">6.875</span>, <span class="hljs-number">24</span>], [<span class="hljs-name">0.09523809523809523</span>, <span class="hljs-number">9.395604395604396</span>, <span class="hljs-number">182</span>]]
[[<span class="hljs-name">0.09523809523809523</span>, <span class="hljs-number">9.557377049180328</span>, <span class="hljs-number">61</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">33</span>], [<span class="hljs-name">1.0</span>, <span class="hljs-number">9.04739336492891</span>, <span class="hljs-number">1477</span>]]



---------------------------------------------------------------------------

TypeError                                 Traceback (<span class="hljs-name">most</span> recent call last)

&lt;ipython-input-44-fac4d6019e62&gt; in &lt;module&gt;
----&gt; <span class="hljs-number">1</span> find_winner_drug_from_condition(<span class="hljs-symbol">'Diarrhea</span>')


&lt;ipython-input-43-2506ea8b1c2b&gt; in find_winner_drug_from_condition(<span class="hljs-name">test_condition</span>, condition_dict)
     <span class="hljs-number">28</span>     top_3_conditions = [<span class="hljs-name">y</span>[<span class="hljs-name">1</span>] for y in sorted(<span class="hljs-name">similarity_scores</span>, key=lambda x:-x[<span class="hljs-name">0</span>])][<span class="hljs-name">:3</span>]
     <span class="hljs-number">29</span>     print(<span class="hljs-name">top_3_conditions</span>)
---&gt; <span class="hljs-number">30</span>     winner_condition = sorted(<span class="hljs-name">top_3_conditions</span>, key=lambda x:-get_average_score(<span class="hljs-name">x</span>))[<span class="hljs-name">0</span>]
     <span class="hljs-number">31</span>     return find_winner_drug(<span class="hljs-name">condition_dict.get</span>(<span class="hljs-name">winner_condition</span>))


&lt;ipython-input-43-2506ea8b1c2b&gt; in &lt;lambda&gt;(<span class="hljs-name">x</span>)
     <span class="hljs-number">28</span>     top_3_conditions = [<span class="hljs-name">y</span>[<span class="hljs-name">1</span>] for y in sorted(<span class="hljs-name">similarity_scores</span>, key=lambda x:-x[<span class="hljs-name">0</span>])][<span class="hljs-name">:3</span>]
     <span class="hljs-number">29</span>     print(<span class="hljs-name">top_3_conditions</span>)
---&gt; <span class="hljs-number">30</span>     winner_condition = sorted(<span class="hljs-name">top_3_conditions</span>, key=lambda x:-get_average_score(<span class="hljs-name">x</span>))[<span class="hljs-name">0</span>]
     <span class="hljs-number">31</span>     return find_winner_drug(<span class="hljs-name">condition_dict.get</span>(<span class="hljs-name">winner_condition</span>))


TypeError: bad operand type for unary -: <span class="hljs-symbol">'tuple</span>'
</code></pre><pre><code class="lang-python">a = {<span class="hljs-string">'Imitrex'</span>: [<span class="hljs-number">0.006711409395973154</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9</span>],
   <span class="hljs-string">'Imitrex Statdose'</span>: [<span class="hljs-number">0.05263157894736842</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">8</span>],
   <span class="hljs-string">'Keppra'</span>: [<span class="hljs-number">0.018292682926829267</span>, <span class="hljs-number">7.234567901234568</span>, <span class="hljs-number">81</span>],
   <span class="hljs-string">'Levetiracetam'</span>: [<span class="hljs-number">0.01762114537444934</span>, <span class="hljs-number">7.395348837209302</span>, <span class="hljs-number">86</span>],
   <span class="hljs-string">'Sumatriptan'</span>: [<span class="hljs-number">0.017543859649122806</span>, <span class="hljs-number">7.4411764705882355</span>, <span class="hljs-number">34</span>]}
</code></pre>
<pre><code class="lang-python"><span class="hljs-selector-tag">a</span>.values()
</code></pre>
<pre><code>dict_values([[<span class="hljs-number">0.006711409395973154</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">0.05263157894736842</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">0.018292682926829267</span>, <span class="hljs-number">7.234567901234568</span>, <span class="hljs-number">81</span>], [<span class="hljs-number">0.01762114537444934</span>, <span class="hljs-number">7.395348837209302</span>, <span class="hljs-number">86</span>], [<span class="hljs-number">0.017543859649122806</span>, <span class="hljs-number">7.4411764705882355</span>, <span class="hljs-number">34</span>]])
</code></pre><h4 id="rxsaver">RxSaver</h4>
<pre><code class="lang-python">https:<span class="hljs-regexp">//</span>rxsaver.retailmenot.com<span class="hljs-regexp">/drugs/</span>amlodipine-besylate<span class="hljs-regexp">/coupons</span>
</code></pre>
<pre><code class="lang-python"><span class="hljs-selector-tag">df_all</span><span class="hljs-selector-class">.columns</span>
</code></pre>
<pre><code><span class="hljs-keyword">Index</span>([<span class="hljs-string">'uniqueID'</span>, <span class="hljs-string">'drugName'</span>, <span class="hljs-string">'condition'</span>, <span class="hljs-string">'review'</span>, <span class="hljs-string">'rating'</span>, <span class="hljs-string">'date'</span>,
       <span class="hljs-string">'usefulCount'</span>, <span class="hljs-string">'year'</span>, <span class="hljs-string">'month'</span>, <span class="hljs-string">'sentiment'</span>,
       <span class="hljs-string">'weighted_by_count_rating'</span>],
      dtype=<span class="hljs-string">'object'</span>)
</code></pre><pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">df_train, <span class="hljs-attr">df_test</span> = train_test_split(df_all, <span class="hljs-attr">test_size=0.33,</span> <span class="hljs-attr">random_state=21)</span>
</code></pre>
<pre><code class="lang-python"><span class="hljs-attr">word_vectorizer</span> = CountVectorizer(
                                  <span class="hljs-attr">analyzer</span> = 'word', 
                                  <span class="hljs-attr">tokenizer</span> = None,
                                  <span class="hljs-attr">preprocessor</span> = None, 
                                  <span class="hljs-attr">stop_words</span> = None, 
                                  <span class="hljs-attr">min_df</span> = <span class="hljs-number">2</span>,
                                  <span class="hljs-attr">ngram_range=(4,</span> <span class="hljs-number">4</span>),
                                  <span class="hljs-attr">max_features</span> = <span class="hljs-number">20000</span>
                                 )
</code></pre>
<pre><code class="lang-python"><span class="hljs-attr">pipeline</span> = Pipeline([(<span class="hljs-string">'vect'</span>, word_vectorizer)])
</code></pre>
<pre><code class="lang-python"><span class="hljs-comment">%%time </span>
train_features = pipeline.fit_transform(df_train[<span class="hljs-string">'clean_review'</span>])
</code></pre>
<pre><code>CPU <span class="hljs-string">times:</span> user <span class="hljs-number">11.9</span> s, <span class="hljs-string">sys:</span> <span class="hljs-number">857</span> ms, <span class="hljs-string">total:</span> <span class="hljs-number">12.8</span> s
Wall <span class="hljs-string">time:</span> <span class="hljs-number">13.1</span> s
</code></pre><pre><code class="lang-python"><span class="hljs-comment">% % time</span>
test_features = pipeline.fit_transform(df_test[<span class="hljs-string">'clean_review'</span>])
</code></pre>
<pre><code>CPU <span class="hljs-string">times:</span> user <span class="hljs-number">6.59</span> s, <span class="hljs-string">sys:</span> <span class="hljs-number">323</span> ms, <span class="hljs-string">total:</span> <span class="hljs-number">6.91</span> s
Wall <span class="hljs-string">time:</span> <span class="hljs-number">7.14</span> s
</code></pre><pre><code class="lang-python">from tensorflow<span class="hljs-selector-class">.python</span><span class="hljs-selector-class">.keras</span><span class="hljs-selector-class">.models</span> import Sequential
from tensorflow<span class="hljs-selector-class">.python</span><span class="hljs-selector-class">.keras</span><span class="hljs-selector-class">.layers</span> import Dense, Bidirectional, LSTM, BatchNormalization, Dropout
from tensorflow<span class="hljs-selector-class">.python</span><span class="hljs-selector-class">.keras</span><span class="hljs-selector-class">.preprocessing</span><span class="hljs-selector-class">.sequence</span> import pad_sequences
</code></pre>
<pre><code class="lang-python">import keras

# <span class="hljs-number">1.</span> Dataset
y_train = df_train[<span class="hljs-string">'sentiment'</span>]
y_test = df_test[<span class="hljs-string">'sentiment'</span>]
solution = y_test.copy()

# <span class="hljs-number">2.</span> <span class="hljs-keyword">Model</span> Structure
<span class="hljs-keyword">model</span> = keras.<span class="hljs-keyword">models</span>.Sequential()

<span class="hljs-keyword">model</span>.add(keras.layers.Dense(<span class="hljs-number">200</span>, input_shape=(<span class="hljs-number">20000</span>,)))
<span class="hljs-keyword">model</span>.add(keras.layers.BatchNormalization())
<span class="hljs-keyword">model</span>.add(keras.layers.Activation(<span class="hljs-string">'relu'</span>))
<span class="hljs-keyword">model</span>.add(keras.layers.Dropout(<span class="hljs-number">0.5</span>))
<span class="hljs-keyword">model</span>.add(keras.layers.Dense(<span class="hljs-number">300</span>))
<span class="hljs-keyword">model</span>.add(keras.layers.BatchNormalization())
<span class="hljs-keyword">model</span>.add(keras.layers.Activation(<span class="hljs-string">'relu'</span>))
<span class="hljs-keyword">model</span>.add(keras.layers.Dropout(<span class="hljs-number">0.5</span>))
<span class="hljs-keyword">model</span>.add(keras.layers.Dense(<span class="hljs-number">100</span>, activation=<span class="hljs-string">'relu'</span>))
<span class="hljs-keyword">model</span>.add(keras.layers.Dense(<span class="hljs-number">1</span>, activation=<span class="hljs-string">'sigmoid'</span>))

# <span class="hljs-number">3.</span> <span class="hljs-keyword">Model</span> compile
<span class="hljs-keyword">model</span>.compile(optimizer=<span class="hljs-string">'adam'</span>, loss=<span class="hljs-string">'binary_crossentropy'</span>,
              metrics=[<span class="hljs-string">'accuracy'</span>])
</code></pre>
<pre><code class="lang-python"><span class="hljs-selector-tag">model</span><span class="hljs-selector-class">.summary</span>()
</code></pre>
<pre><code>Model: "sequential_1"
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
<span class="hljs-section">Layer (type)                 Output Shape              Param #   
=================================================================</span>
dense_1 (Dense)              (None, 200)               4000200   
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
batch<span class="hljs-emphasis">_normalization_</span>1 (Batch (None, 200)               800       
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
activation_2 (Activation)    (None, 200)               0         
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
dropout_1 (Dropout)          (None, 200)               0         
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
dense_2 (Dense)              (None, 300)               60300     
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
batch<span class="hljs-emphasis">_normalization_</span>2 (Batch (None, 300)               1200      
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
activation_3 (Activation)    (None, 300)               0         
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
dropout_2 (Dropout)          (None, 300)               0         
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
dense_3 (Dense)              (None, 100)               30100     
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
<span class="hljs-section">dense_4 (Dense)              (None, 1)                 101       
=================================================================</span>
Total params: 4,092,701
Trainable params: 4,091,701
Non-trainable params: 1,000
<span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span><span class="hljs-strong">_____</span>
</code></pre><pre><code class="lang-python"><span class="hljs-comment"># 4. Train</span>
<span class="hljs-attr">history</span> = model.fit(train_features, y_train, <span class="hljs-attr">epochs=10,</span> <span class="hljs-attr">batch_size=64)</span>
</code></pre>
<pre><code>Epoch <span class="hljs-number">1</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 392s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.5890</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7086</span>
Epoch <span class="hljs-number">2</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 380s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.5087</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7517</span>
Epoch <span class="hljs-number">3</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 376s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4723</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7686</span>
Epoch <span class="hljs-number">4</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 375s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4522</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7771</span>
Epoch <span class="hljs-number">5</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 383s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4391</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7823</span>
Epoch <span class="hljs-number">6</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 366s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4299</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7863</span>
Epoch <span class="hljs-number">7</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 365s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4227</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7893</span>
Epoch <span class="hljs-number">8</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 360s 3ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4175</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7919</span>
Epoch <span class="hljs-number">9</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 359s 2ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4128</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7934</span>
Epoch <span class="hljs-number">10</span>/<span class="hljs-number">10</span>
<span class="hljs-number">144092</span><span class="hljs-regexp">/144092 [==============================] - 358s 2ms/</span>step - <span class="hljs-string">loss:</span> <span class="hljs-number">0.4102</span> - <span class="hljs-string">accuracy:</span> <span class="hljs-number">0.7947</span>
</code></pre><pre><code class="lang-python">fig, <span class="hljs-built_in">axes</span> = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">24</span>, <span class="hljs-number">12</span>))

# Plot the accuracy
<span class="hljs-built_in">axes</span>[<span class="hljs-number">0</span>].plot(history.history['accuracy'])
<span class="hljs-built_in">axes</span>[<span class="hljs-number">0</span>].set_xlabel('Epoch', Fontsize=<span class="hljs-number">28</span>)
<span class="hljs-built_in">axes</span>[<span class="hljs-number">0</span>].set_ylabel('Accuracy', Fontsize=<span class="hljs-number">28</span>)
<span class="hljs-built_in">axes</span>[<span class="hljs-number">0</span>].set_title('Model Accuracy', Fontsize=<span class="hljs-number">34</span>)

# Plot the loss
<span class="hljs-built_in">axes</span>[<span class="hljs-number">1</span>].plot(history.history['loss'], 'r')
<span class="hljs-built_in">axes</span>[<span class="hljs-number">1</span>].set_xlabel('Epoch', Fontsize=<span class="hljs-number">28</span>)
<span class="hljs-built_in">axes</span>[<span class="hljs-number">1</span>].set_ylabel('Loss', Fontsize=<span class="hljs-number">28</span>)
<span class="hljs-built_in">axes</span>[<span class="hljs-number">1</span>].set_title('Model Loss', Fontsize=<span class="hljs-number">34</span>,)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):
    <span class="hljs-keyword">for</span> tick <span class="hljs-keyword">in</span> <span class="hljs-built_in">axes</span>[i].<span class="hljs-built_in">xaxis</span>.get_major_ticks():
        tick.<span class="hljs-built_in">label</span>.set_fontsize(<span class="hljs-number">22</span>)
    <span class="hljs-keyword">for</span> tick <span class="hljs-keyword">in</span> <span class="hljs-built_in">axes</span>[i].<span class="hljs-built_in">yaxis</span>.get_major_ticks():
        tick.<span class="hljs-built_in">label</span>.set_fontsize(<span class="hljs-number">22</span>)
    <span class="hljs-built_in">axes</span>[i].<span class="hljs-built_in">yaxis</span>.labelpad = <span class="hljs-number">20</span>
    <span class="hljs-built_in">axes</span>[i].<span class="hljs-built_in">xaxis</span>.labelpad = <span class="hljs-number">20</span>
plt.<span class="hljs-built_in">show</span>()
</code></pre>
<p><img src="output_116_0.png" alt="png"></p>
<pre><code class="lang-python">fig, ax1 = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, figsize=(<span class="hljs-number">18</span>, <span class="hljs-number">12</span>))

<span class="hljs-comment"># Plot the accuracy</span>
ax1.plot(<span class="hljs-keyword">history</span>.<span class="hljs-keyword">history</span>[<span class="hljs-string">'accuracy'</span>], <span class="hljs-string">'b'</span>)
ax1.set_xlabel(<span class="hljs-string">'Epoch'</span>, Fontsize=<span class="hljs-number">28</span>)
ax1.set_ylabel(<span class="hljs-string">'Accuracy'</span>, Fontsize=<span class="hljs-number">28</span>, color=<span class="hljs-string">'b'</span>)
ax1.set_ylim([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
<span class="hljs-comment"># Plot the loss</span>
ax2 = ax1.twinx()
ax2.plot(<span class="hljs-keyword">history</span>.<span class="hljs-keyword">history</span>[<span class="hljs-string">'loss'</span>], <span class="hljs-string">'r'</span>)
ax2.set_ylabel(<span class="hljs-string">'Loss'</span>, Fontsize=<span class="hljs-number">28</span>, color=<span class="hljs-string">'r'</span>)
ax2.set_ylim([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
ax2yticklabs = ax2.get_yticklabels()
<span class="hljs-comment"># for tick in ax1.xaxis.get_major_ticks():</span>
<span class="hljs-comment">#     tick.label.set_fontsize(22)</span>
<span class="hljs-comment"># for tick in ax1.yaxis.get_major_ticks():</span>
<span class="hljs-comment">#     tick.label.set_fontsize(22)</span>
<span class="hljs-comment"># for tick in ax2.yaxis.get_major_ticks():</span>
<span class="hljs-comment">#     tick.label.set_fontsize(22)</span>
ax2.set_yticklabels([<span class="hljs-string">'{0:.2f}'</span>.<span class="hljs-keyword">format</span>(x)
                     <span class="hljs-keyword">for</span> x in np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>)], fontsize=<span class="hljs-number">22</span>)
ax1.set_yticklabels([<span class="hljs-string">'{0:.2f}'</span>.<span class="hljs-keyword">format</span>(x)
                     <span class="hljs-keyword">for</span> x in np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>)], fontsize=<span class="hljs-number">22</span>)
ax1.set_xticklabels([<span class="hljs-string">'{0:d}'</span>.<span class="hljs-keyword">format</span>(x) <span class="hljs-keyword">for</span> x in range(<span class="hljs-number">-2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)], fontsize=<span class="hljs-number">22</span>)

plt.title(<span class="hljs-string">'Model Accuracy and Loss'</span>, Fontsize=<span class="hljs-number">34</span>)
plt.show()
</code></pre>
<p><img src="output_117_0.png" alt="png"></p>
<pre><code class="lang-python"><span class="hljs-built_in">import</span> os
<span class="hljs-built_in">import</span> tempfile
from gensim.test.utils <span class="hljs-built_in">import</span> datapath
from gensim.models.fasttext <span class="hljs-built_in">import</span> FastText as FT_gensim
from pprint <span class="hljs-built_in">import</span> pprint as print
<span class="hljs-built_in">import</span> logging
logging.basicConfig(
    <span class="hljs-attr">format='%(asctime)s</span> : %(levelname)s : %(message)s', <span class="hljs-attr">level=logging.INFO)</span>


<span class="hljs-comment"># Set file names for train and test data</span>
<span class="hljs-attr">corpus_file</span> = datapath('lee_background.cor')

<span class="hljs-attr">model</span> = FT_gensim(<span class="hljs-attr">size=100)</span>

<span class="hljs-comment"># build the vocabulary</span>
model.build_vocab(<span class="hljs-attr">corpus_file=corpus_file)</span>

<span class="hljs-comment"># train the model</span>
model.train(
    <span class="hljs-attr">corpus_file=corpus_file,</span> <span class="hljs-attr">epochs=model.epochs,</span>
    <span class="hljs-attr">total_examples=model.corpus_count,</span> <span class="hljs-attr">total_words=model.corpus_total_words</span>
)

print(model)
<span class="hljs-comment"># saving a model trained via Gensim's fastText implementation</span>
<span class="hljs-keyword">with</span> tempfile.NamedTemporaryFile(<span class="hljs-attr">prefix='saved_model_gensim-',</span> <span class="hljs-attr">delete=False)</span> as tmp:
    model.save(tmp.name, <span class="hljs-attr">separately=[])</span>

<span class="hljs-attr">loaded_model</span> = FT_gensim.load(tmp.name)
print(loaded_model)

os.unlink(tmp.name)
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">
</code></pre>
<h3 id="gensim-word2vec-sentiment-predictor">Gensim Word2Vec - Sentiment Predictor</h3>
<p>We will use the <strong><em>goodness/badness</em></strong> of the review as one of the feature later on to use for the recommendation learning process.</p>
<pre><code class="lang-python">import dill

#dill.dump(df_all, <span class="hljs-keyword">open</span>(<span class="hljs-symbol">'df_all</span>.pkd', <span class="hljs-symbol">'wb'</span>))
df_all = dill.load(<span class="hljs-keyword">open</span>(<span class="hljs-symbol">'df_all</span>.pkd', <span class="hljs-symbol">'rb'</span>))
</code></pre>
<pre><code class="lang-python"><span class="hljs-comment"># is it a compliment or a criticism?</span>
df_all[<span class="hljs-string">'sentiment'</span>] = df_all[<span class="hljs-string">"rating"</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">5</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)
</code></pre>
<p><a href="https://kavita-ganesan.com/how-to-use-countvectorizer/#Using-CountVectorizer-to-Extract-N-Gram-Term-Counts">https://kavita-ganesan.com/how-to-use-countvectorizer/#Using-CountVectorizer-to-Extract-N-Gram-Term-Counts</a></p>
<pre><code class="lang-python">from sklearn.feature_extraction.text <span class="hljs-built_in">import</span> CountVectorizer

<span class="hljs-attr">vectorizer</span> = CountVectorizer(<span class="hljs-attr">analyzer='word',</span>
                             <span class="hljs-attr">tokenizer=None,</span>
                             <span class="hljs-attr">preprocessor=None,</span>
                             <span class="hljs-attr">stop_words=None,</span>
                             <span class="hljs-attr">min_df=2,</span>
                             <span class="hljs-attr">ngram_range=(4,</span> <span class="hljs-number">4</span>),
                             <span class="hljs-attr">max_features=20000)</span>

df_train, <span class="hljs-attr">df_test</span> = train_test_split(df_all, <span class="hljs-attr">test_size=0.25,</span> <span class="hljs-attr">random_state=1)</span>
<span class="hljs-attr">pipeline</span> = Pipeline([
    ('vect', vectorizer),
])
</code></pre>
<h3 id="gensim-word2vec">Gensim Word2Vec</h3>
<p>Extract meaningful <strong>english</strong> words</p>
<pre><code class="lang-python"># <span class="hljs-keyword">import</span> dill
# drug_condition_dict = dill.load(open(<span class="hljs-string">'util/drug_condition_dict.pkd'</span>, <span class="hljs-string">'rb'</span>))
</code></pre>
<pre><code class="lang-python"><span class="hljs-comment"># disabling Named Entity Recognition for speed</span>
nlp = spacy.<span class="hljs-built_in">load</span>(<span class="hljs-string">'en_core_web_sm'</span>, disable=[<span class="hljs-string">'ner'</span>, <span class="hljs-string">'parser'</span>])


def cleaning(doc):
    <span class="hljs-comment"># Lemmatizes and removes stopwords</span>
    <span class="hljs-comment"># doc needs to be a spacy Doc object</span>
    txt = [<span class="hljs-keyword">token</span>.lemma_ <span class="hljs-keyword">for</span> <span class="hljs-keyword">token</span> <span class="hljs-keyword">in</span> doc <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">token</span>.is_stop]
    <span class="hljs-comment"># Word2Vec uses context words to learn the vector representation of a target word,</span>
    <span class="hljs-comment"># if a sentence is only one or two words long,</span>
    <span class="hljs-comment"># the benefit for the training is very small</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(txt) &gt; <span class="hljs-number">2</span>:
        <span class="hljs-literal">return</span> <span class="hljs-string">' '</span>.join(txt)
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python"><span class="hljs-selector-tag">df_all</span><span class="hljs-selector-attr">['condition']</span><span class="hljs-selector-class">.head</span>()
</code></pre>
<pre><code><span class="hljs-number">0</span>    <span class="hljs-keyword">Left</span> Ventricular Dysfunction
<span class="hljs-number">1</span>                            ADHD
<span class="hljs-number">2</span>                   Birth <span class="hljs-keyword">Control</span>
<span class="hljs-number">3</span>                   Birth <span class="hljs-keyword">Control</span>
<span class="hljs-number">4</span>               Opiate Dependence
Name: condition, dtype: object
</code></pre><pre><code class="lang-python">brief_cleaning = (<span class="hljs-name">re</span>.sub(<span class="hljs-string">"[^A-Za-z']+"</span>, ' ', str(<span class="hljs-name">row</span>)).lower() for row in df_all['condition'])
</code></pre>
<pre><code class="lang-python">#dill.dump(df_clean, <span class="hljs-keyword">open</span>(<span class="hljs-symbol">'df_clean</span>.pkd', <span class="hljs-symbol">'wb'</span>))
df_clean = dill.load(<span class="hljs-keyword">open</span>(<span class="hljs-symbol">'df_clean</span>.pkd', <span class="hljs-symbol">'rb'</span>))
</code></pre>
<pre><code class="lang-python">from <span class="hljs-built_in">time</span> <span class="hljs-keyword">import</span> <span class="hljs-built_in">time</span>
<span class="hljs-keyword">import</span> re
t = <span class="hljs-built_in">time</span>()
txt = [cleaning(doc) <span class="hljs-keyword">for</span> doc <span class="hljs-built_in">in</span> nlp.pipe(brief_cleaning, batch_size=<span class="hljs-number">5000</span>, n_threads=-<span class="hljs-number">1</span>)]
print(<span class="hljs-string">'Time to clean up everything: {} mins'</span>.format(round((<span class="hljs-built_in">time</span>() - t) / <span class="hljs-number">60</span>, <span class="hljs-number">2</span>)))
</code></pre>
<pre><code>Time <span class="hljs-keyword">to</span> clean <span class="hljs-keyword">up</span> everythin<span class="hljs-variable">g:</span> <span class="hljs-number">0.78</span> mins
</code></pre><pre><code class="lang-python"><span class="hljs-meta"># df_clean = pd.DataFrame({'clean_conditions': txt})</span>
<span class="hljs-meta"># df_clean = df_clean.dropna().drop_duplicates()</span>
df_clean.shape
</code></pre>
<pre><code>(<span class="hljs-number">265</span>, <span class="hljs-number">1</span>)
</code></pre><pre><code class="lang-python">df_condition = df_all.groupby([<span class="hljs-string">'condition'</span>])[<span class="hljs-string">'drugName'</span>].nunique().sort_values(ascending=<span class="hljs-symbol">False</span>)
df_condition = pd.<span class="hljs-symbol">DataFrame</span>(df_condition).reset_index()
df_condition.tail(<span class="hljs-number">5</span>)
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>condition</th>
      <th>drugName</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>831</th>
      <td>Tympanostomy Tube Placement Surgery</td>
      <td>1</td>
    </tr>
    <tr>
      <th>832</th>
      <td>Muscle Twitching</td>
      <td>1</td>
    </tr>
    <tr>
      <th>833</th>
      <td>Somatoform Pain Disorde</td>
      <td>1</td>
    </tr>
    <tr>
      <th>834</th>
      <td>acial Lipoatrophy</td>
      <td>1</td>
    </tr>
    <tr>
      <th>835</th>
      <td>Rabies Prophylaxis</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="extra-drug-conditions-collected-from-drugbank">Extra drug conditions collected from drugbank</h3>
<pre><code class="lang-python"><span class="hljs-attr">drugs_per_condition_dict</span> = dill.load(open(<span class="hljs-string">'util/drugs_per_condition_dict.pkd'</span>, <span class="hljs-string">'rb'</span>))
<span class="hljs-attr">condition_links_dict</span> = dill.load(open(<span class="hljs-string">'util/condition_links_dict.pkd'</span>, <span class="hljs-string">'rb'</span>))
</code></pre>
<pre><code class="lang-python"><span class="hljs-attr">drug_condition_dict</span> = dill.load(open(<span class="hljs-string">'util/drug_condition_dict.pkd'</span>, <span class="hljs-string">'rb'</span>))
<span class="hljs-attr">drug_codes_dict</span> = dill.load(open(<span class="hljs-string">'util/drug_codes_dict.pkd'</span>, <span class="hljs-string">'rb'</span>))
</code></pre>
<pre><code class="lang-python">drug_lookup = lambda x: drug_condition_dict.<span class="hljs-built_in">get</span>(x.<span class="hljs-built_in">lower</span>()) <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> [y.<span class="hljs-built_in">lower</span>() <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> drug_condition_dict.<span class="hljs-built_in">keys</span>()] <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>
drug_lookup(<span class="hljs-string">'azithromaycin'</span>)
</code></pre>
<pre><code>&#39;&#39;
</code></pre><h2 id="similar-drugs-for-a-health-condition">Similar drugs for a health condition</h2>
<p><a href="https://www.goodrx.com/conditions">https://www.goodrx.com/conditions</a></p>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python">
</code></pre>
<pre><code class="lang-python"><span class="hljs-meta"># setting a df with conditions with only one drug</span>
df_condition_1 = df_condition[df_condition[<span class="hljs-string">'drugName'</span>] == <span class="hljs-number">1</span>].reset_index()

all_list = <span class="hljs-keyword">set</span>(data.index)

<span class="hljs-meta"># deleting them</span>
condition_list = []
<span class="hljs-keyword">for</span> i,j <span class="hljs-keyword">in</span> enumerate(data[<span class="hljs-string">'condition'</span>]):<span class="hljs-type"></span>
    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> list(df_condition_1[<span class="hljs-string">'condition'</span>]):<span class="hljs-type"></span>
        <span class="hljs-keyword">if</span> j == c:<span class="hljs-type"></span>
            condition_list.append(i)

<span class="hljs-keyword">new</span><span class="hljs-type">_idx</span> = all_list.difference(<span class="hljs-keyword">set</span>(condition_list))
data = data.iloc[list(<span class="hljs-keyword">new</span><span class="hljs-type">_idx</span>)].reset_index()
del data[<span class="hljs-string">'index'</span>]
</code></pre>
<pre><code><span class="hljs-comment">---------------------------------------------------------------------------</span>

NameError                                 Traceback (most recent <span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>)

&lt;ipython-<span class="hljs-keyword">input</span><span class="hljs-number">-51</span><span class="hljs-number">-1</span>de3700282c8&gt; <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;
      <span class="hljs-number">2</span> df_condition_1 = df_condition[df_condition[<span class="hljs-string">'drugName'</span>] == <span class="hljs-number">1</span>].reset_index()
      <span class="hljs-number">3</span> 
<span class="hljs-comment">----&gt; 4 all_list = set(data.index)</span>
      <span class="hljs-number">5</span> 
      <span class="hljs-number">6</span> # deleting them


NameError: <span class="hljs-keyword">name</span> <span class="hljs-string">'data'</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined
</code></pre><pre><code class="lang-python"><span class="hljs-keyword">import</span> gensim
<span class="hljs-title">from</span> gensim.models.phrases <span class="hljs-keyword">import</span> Phrases, Phraser
</code></pre>
<pre><code class="lang-python">
</code></pre>


              </div>
          </div>
        </div>
<!--         <div class="container">
          <div class="row">
            <div class="col text-center">
              <a class="btn btn-notebook" role="button" href="https://github.com/alineu/pyDataScintist-Notebooks/blob/main/miniprojects/mushrooms_dt.ipynb">Link to the <strong>ipython notebook</strong></a>
            </div>
          </div>
        </div> -->
      </section>
    </main>

<!-- ======= Footer ======= -->

    <footer id="footer" data-aos="fade-up" data-aos-easing="ease-in-out" data-aos-duration="500">
      <div class="footer-newsletter">
        <div class="container">
          <div class="row">
            <div class="col-lg-6">
              <h4><a class="header_arg" id=""></a>Newsletter</h4>
              <p>Subscribe here to get notified when a new material is posted</p>
            </div>
            <div class="col-lg-6">
              <form action="" method="post">
                <input type="email" name="email"><input type="submit" value="Subscribe">
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-top">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-6 footer-links">
              <h4><a class="header_arg" id=""></a>Useful Links</h4>
              <ul>
                <li><i class="bx bx-chevron-right"></i> <a href="#">Home</a></li>
                <li><i class="bx bx-chevron-right"></i> <a href="#">About Me</a></li>
                <li><i class="bx bx-chevron-right"></i> <a href="#">Projects</a></li>
                <li><i class="bx bx-chevron-right"></i> <a href="#">Tutorials</a></li>
              </ul>
            </div>
            <div class="col-lg-4 col-md-6 footer-contact">
              <h4><a class="header_arg" id=""></a>Contact</h4>
              <p>
                913 Boylston Street<br>
               <p> Boston, MA 02115<br>
               <p> United States <br><br>
                <strong>Phone:</strong> +1 617 460 0555<br>
                <strong>Email:</strong> alimehdirahim@gmail.com<br>
              </p>
            </div>
            <div class="col-lg-4 col-md-6 footer-info">
              <h3><a class="header_arg" id=""></a>About Me</h3>
              <p>
               <p> A data science enthusiast! I love developing new machine learning algorithms to address real-world problems. I try to learn something new on a daily basis.
              </p>
              <div class="social-links mt-3">
                <a href="https://github.com/alineu" class="Github"><i class="bx bxl-github"></i></a>
                <a href="https://www.linkedin.com/in/alimehdizadehrahimi/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
                <a href="https://twitter.com/estoyali" class="twitter"><i class="bx bxl-twitter"></i></a>
                <a href="https://instagram.com/aliexplores" class="instagram"><i class="bx bxl-instagram"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="copyright">
          &copy; Copyright 2021 <strong><span>Ali Mehdizadeh</span></strong>. All Rights Reserved
        </div>
        <div class="credits">
          <p>
            Page design is adopted from <a href="https://bootstrapmade.com/">BootstrapMade</a>.<br>Page icons were taken from <a href="https://www.flaticon.com">flaticon.com</a>.
          </p>
        </div>
      </div>
    </footer><!-- End Footer -->
    <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>
    <!-- Vendor JS Files -->
    <script type="text/javascript" src="../../assets/vendor/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/jquery.easing/jquery.easing.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/php-email-form/validate.js"></script>
    <script type="text/javascript" src="../../assets/vendor/venobox/venobox.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/waypoints/jquery.waypoints.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/counterup/counterup.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../../assets/vendor/prism/prism.js"></script>
    <script type="text/javascript" src="../../assets/vendor/aos/aos.js"></script>
    <!-- Template Main JS File -->
    <script src="../../assets/js/main.js"></script>
    <!-- MathJax JS File -->
    <script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
      MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [["$", "$"], ["\\(", "\\)"]],
      processEscapes: true
      }
      });
    </script>
  </body>
</html>
